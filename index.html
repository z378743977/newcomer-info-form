<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Â§öËØ≠Ë®ÄË°®ÂçïÂ°´ÂÜôÂ∫îÁî®ÔºàÁßªÂä®Á´Ø‰∏ãËΩΩÂÖºÂÆπÁâàÔºâ</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { min-height:100vh; position:relative; }
    body {
      font-family: -apple-system,BlinkMacSystemFont,'Segoe UI','Microsoft YaHei',sans-serif;
      background: linear-gradient(135deg, #F5F5F0 0%, #D4E4E7 50%, #B8D4D6 100%);
      min-height:100vh; padding:20px; position:relative; overflow-x:hidden;
    }
    body::before {
      content:''; position:fixed; top:-50%; right:-50%; width:200%; height:200%;
      background: radial-gradient(circle, rgba(74,144,164,.05) 0%, transparent 70%);
      animation: rotate 30s linear infinite; pointer-events:none; z-index:0;
    }
    @keyframes rotate { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
    #app { position:relative; z-index:1; }
    .container {
      max-width:500px; margin:0 auto; background:#FAFAF8; border-radius:12px;
      box-shadow:0 10px 40px rgba(46,79,122,.15); padding:30px;
      border:1px solid rgba(62,95,138,.1);
    }
    .admin-container { max-width:1400px; }
    h1 { text-align:center; color:#2E4F7A; font-size:24px; margin-bottom:30px; font-weight:bold; }
    .admin-title { color:#1E3A5F; font-size:28px; }
    label { display:block; font-weight:600; font-size:14px; margin-bottom:8px; color:#2C3E50; transition:all .3s; }
    .form-group:hover label { color:#3E5F8A; transform:translateX(3px); }
    input[type='text'], input[type='date'], input[type='number'], select {
      width:100%; padding:10px 15px; border:2px solid #D4E4E7; border-radius:8px; font-size:14px; transition:all .3s; background:#fff;
    }
    input:focus, select:focus {
      outline:none; border-color:#3E5F8A; box-shadow:0 0 0 3px rgba(62,95,138,.1); transform:translateY(-2px); background:#FEFEFE;
    }
    .form-group{ margin-bottom:20px; }
    .language-buttons{ display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:30px; }
    .lang-btn, .tab-btn, .field-btn, .toggle-btn, .action-btn {
      padding:10px; border:none; border-radius:8px; background:#E8F0F2; color:#2C3E50; font-weight:500; cursor:pointer;
      transition:all .3s; border:1px solid rgba(62,95,138,.2);
    }
    .lang-btn:hover, .tab-btn:hover, .field-btn:hover, .toggle-btn:hover, .action-btn:hover { background:#D4E4E7; transform:translateY(-2px); box-shadow:0 4px 12px rgba(62,95,138,.15); }
    .lang-btn.active, .tab-btn.active { background:#3E5F8A; color:#fff; }
    .signature-container{ border:2px solid #B8D4D6; border-radius:8px; overflow:hidden; margin-top:10px; transition:all .3s; }
    .signature-container:hover{ border-color:#4A90A4; box-shadow:0 4px 16px rgba(74,144,164,.2); transform:scale(1.01); }
    canvas{ display:block; width:100%; background:#fff; cursor:crosshair; touch-action:none; }
    .clear-btn{ margin-top:10px; background:none; border:none; color:#C73E1D; font-size:14px; cursor:pointer; text-decoration:underline; }
    .clear-btn:hover{ color:#A32E15; }
    .generate-btn{
      width:100%; padding:15px; background:linear-gradient(135deg,#3E5F8A 0%, #2E4F7A 100%); color:#fff; border:none; border-radius:8px;
      font-size:16px; font-weight:600; cursor:pointer; margin-top:30px; transition:all .3s; display:flex; align-items:center; justify-content:center; gap:10px;
      box-shadow:0 4px 12px rgba(62,95,138,.2);
    }
    .generate-btn:hover{ background:linear-gradient(135deg,#2E4F7A 0%,#1E3A5F 100%); transform:translateY(-2px); box-shadow:0 6px 16px rgba(62,95,138,.3); }
    .note{ text-align:center; font-size:12px; color:#5A7A8F; margin-top:20px; }
    .admin-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; }
    .admin-layout{ display:grid; grid-template-columns:2fr 1fr; gap:30px; }
    .left-panel,.right-panel{
      background:#FAFAF8; padding:20px; border-radius:12px; box-shadow:0 2px 8px rgba(62,95,138,.1); border:1px solid rgba(62,95,138,.1);
    }
    .section-title{ font-size:18px; font-weight:700; color:#2E4F7A; margin-bottom:15px; padding-bottom:10px; border-bottom:2px solid #B8D4D6; }
    .template-tabs,.language-tabs{ display:flex; gap:10px; margin-bottom:20px; }
    .field-buttons{ display:flex; flex-wrap:wrap; gap:8px; margin-bottom:20px; }
    .preview-box{ border:2px solid #A8DADC; background:#F0F8F9; padding:15px; border-radius:8px; margin-bottom:20px; }
    .image-wrapper{ position:relative; display:inline-block; max-width:100%; }
    .preview-box img{ max-width:100%; cursor:crosshair; border:2px dashed #A8DADC; display:block; }
    #markersContainer{ position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; }
    .field-marker{
      position:absolute; width:28px; height:28px; background:rgba(74,144,164,.9); color:#fff; border-radius:50%;
      display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:700; transform:translate(-50%,-150%);
      box-shadow:0 2px 8px rgba(62,95,138,.3); border:3px solid #fff; z-index:10;
    }
    .field-label{ position:absolute; background:rgba(74,144,164,.95); color:#fff; padding:4px 10px; border-radius:4px; font-size:11px; font-weight:600; transform:translate(-50%,-250%); white-space:nowrap; z-index:10; }
    .field-preview-text{ position:absolute; pointer-events:none; z-index:8; white-space:nowrap; opacity:.9; }
    .field-list{ margin-top:20px; }
    .field-item{ background:#F5F8F9; border:1px solid #D4E4E7; border-radius:8px; padding:12px; margin-bottom:10px; }
    .field-item-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .field-name{ font-weight:600; color:#2E4F7A; }
    .field-actions{ display:flex; gap:8px; }
    .edit-btn{ padding:4px 12px; border:none; border-radius:4px; cursor:pointer; font-size:12px; background:#3E5F8A; color:#fff; }
    .delete-btn{ padding:4px 12px; border:none; border-radius:4px; cursor:pointer; font-size:12px; background:#C73E1D; color:#fff; }
    .reposition-btn{ padding:4px 12px; border:none; border-radius:4px; cursor:pointer; font-size:12px; background:#F7B500; color:#fff; }
    .param-editor{ background:#fff; border:2px solid #3E5F8A; border-radius:8px; padding:15px; margin-top:10px; }
    .param-row{ display:grid; grid-template-columns:100px 1fr; gap:10px; margin-bottom:12px; align-items:center; }
    .param-label{ font-size:13px; font-weight:600; color:#2C3E50; }
    .save-param-btn{ width:100%; padding:8px; background:#4A90A4; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:600; }
    .upload-section{ margin-bottom:20px; padding:15px; background:#F5F8F9; border-radius:8px; border:1px solid #D4E4E7; }
    .mode-switch{ margin-top:15px; padding:12px; background:#F0F8F9; border:2px solid #A8DADC; border-radius:8px; display:flex; align-items:center; gap:10px; }
    .password-container{ max-width:400px; text-align:center; }
    .password-title{ font-size:24px; font-weight:700; color:#2E4F7A; margin-bottom:10px; }
    .password-subtitle{ color:#5A7A8F; margin-bottom:20px; font-size:14px; }
    .password-input{ width:100%; padding:15px; border:2px solid #D4E4E7; border-radius:8px; font-size:16px; margin-bottom:12px; text-align:center; letter-spacing:2px; background:#fff; }
    .password-btn{ width:100%; padding:15px; background:linear-gradient(135deg,#3E5F8A 0%, #2E4F7A 100%); color:#fff; border:none; border-radius:8px; font-size:16px; font-weight:600; cursor:pointer; }
    .password-error{ color:#C73E1D; font-size:14px; margin-top:10px; display:none; }
    .password-error.show{ display:block; }
    
    /* ËôöÊãüÈîÆÁõòÊ†∑Âºè */
    .virtual-keyboard {
      margin-top: 15px;
      padding: 15px;
      background: #F0F8F9;
      border-radius: 8px;
      border: 2px solid #B8D4D6;
    }
    .keyboard-title {
      font-size: 14px;
      font-weight: 600;
      color: #2E4F7A;
      margin-bottom: 10px;
      text-align: center;
    }
    .keyboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
      gap: 5px;
      max-height: 300px;
      overflow-y: auto;
    }
    .char-btn {
      padding: 10px 5px;
      background: #fff;
      border: 1px solid #D4E4E7;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: all .2s;
      text-align: center;
    }
    .char-btn:hover {
      background: #3E5F8A;
      color: #fff;
      transform: scale(1.05);
    }
    .char-btn:active {
      transform: scale(0.95);
    }
    .keyboard-controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .keyboard-control-btn {
      flex: 1;
      padding: 8px;
      background: #E8F0F2;
      border: 1px solid #B8D4D6;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all .2s;
    }
    .keyboard-control-btn:hover {
      background: #D4E4E7;
    }
    .keyboard-toggle-btn {
      margin-left: 10px;
      background: #3E5F8A;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
      transition: all .2s;
    }
    .keyboard-toggle-btn:hover {
      background: #2E4F7A;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // ===================== Â§öËØ≠Ë®Ä‰∏éÂ∑•Áßç =====================
    const translations = {
      zh:{ title:'ÂëòÂ∑•‰ø°ÊÅØË°®Âçï', selectLanguage:'ÈÄâÊã©ËØ≠Ë®Ä', name:'ÂßìÂêç', translateName:'ÁøªËØë', birthday:'ÁîüÊó•', address:'Âú∞ÂùÄ', addressSearch:'ÊêúÁ¥¢Âú∞ÂùÄ', position:'ËÅå‰Ωç', positionCustom:'Ëá™Â°´', positionSelect:'ÈÄâÊã©Â∑•Áßç', passport:'Êä§ÁÖßÂè∑', phone:'ÊâãÊú∫Âè∑', experience:'Â∑•‰ΩúÁªèÂéÜ', experienceYears:'Âπ¥', signature:'Á≠æÂêç', clearSignature:'Ê∏ÖÈô§Á≠æÂêç', generate:'ÁîüÊàêË°®Âçï', complete:'‚úÖ ÂÆåÊàêÂ°´ÂÜô', downloadTitle:'‰∏ãËΩΩË°®Âçï', backToForm:'‚Üê ËøîÂõûË°®Âçï', generateFirst:'‚ë† ‰∏ãËΩΩÂä≥Âä®ÂêàÂêå', generateSecond:'‚ë° ‰∏ãËΩΩÂÆâÂÖ®ÂçèËÆÆ', sendToAdmin:'‚ë¢ ÂèëÈÄÅËá≥ÁÆ°ÁêÜÂëò', adminMode:'ÁÆ°ÁêÜÂëòÊ®°Âºè', userMode:'Áî®Êà∑Ê®°Âºè', addressHint:'üí° Âú®NaverÂú∞Âõæ‰∏≠ÊêúÁ¥¢Âú∞ÂùÄ,ÁÑ∂ÂêéÂ§çÂà∂Á≤òË¥¥Âà∞ËæìÂÖ•Ê°Ü', downloadHint:'ËØ∑ÊåâÈ°∫Â∫è‰∏ãËΩΩ‰∏§‰∏™Ë°®ÂçïÔºåÁÑ∂ÂêéÂèëÈÄÅÁªôÁÆ°ÁêÜÂëò' },
      ko:{ title:'ÏßÅÏõê Ï†ïÎ≥¥ ÏñëÏãù', selectLanguage:'Ïñ∏Ïñ¥ ÏÑ†ÌÉù', name:'ÏÑ±Î™Ö', translateName:'Î≤àÏó≠', birthday:'ÏÉùÎÖÑÏõîÏùº', address:'Ï£ºÏÜå', addressSearch:'Ï£ºÏÜå Í≤ÄÏÉâ', position:'ÏßÅÏ¢Ö', positionCustom:'ÏßÅÏ†ë ÏûÖÎ†•', positionSelect:'ÏÑ†ÌÉù', residentNum:'Ï£ºÎØºÎì±Î°ùÎ≤àÌò∏', phone:'Ï†ÑÌôîÎ≤àÌò∏', experience:'Í≤ΩÎ†•', experienceYears:'ÎÖÑ', signature:'ÏÑúÎ™Ö', clearSignature:'ÏÑúÎ™Ö ÏßÄÏö∞Í∏∞', generate:'ÏñëÏãù ÏÉùÏÑ±', complete:'‚úÖ ÏûëÏÑ± ÏôÑÎ£å', downloadTitle:'ÏñëÏãù Îã§Ïö¥Î°úÎìú', backToForm:'‚Üê ÏñëÏãùÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞', generateFirst:'‚ë† Í∑ºÎ°úÍ≥ÑÏïΩÏÑú Îã§Ïö¥Î°úÎìú', generateSecond:'‚ë° ÏïàÏ†ÑÌòëÏïΩ Îã§Ïö¥Î°úÎìú', sendToAdmin:'‚ë¢ Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Ï†ÑÏÜ°', adminMode:'Í¥ÄÎ¶¨Ïûê Î™®Îìú', userMode:'ÏÇ¨Ïö©Ïûê Î™®Îìú', addressHint:'üí° Naver ÏßÄÎèÑÏóêÏÑú Ï£ºÏÜåÎ•º Í≤ÄÏÉâÌïú ÌõÑ ÏûÖÎ†•ÎûÄÏóê Î∂ôÏó¨ÎÑ£Í∏∞ ÌïòÏÑ∏Ïöî', downloadHint:'Îëê ÏñëÏãùÏùÑ ÏàúÏÑúÎåÄÎ°ú Îã§Ïö¥Î°úÎìúÌïú ÌõÑ Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Ï†ÑÏÜ°ÌïòÏÑ∏Ïöî' },
      vi:{ title:'M·∫´u th√¥ng tin nh√¢n vi√™n', selectLanguage:'Ch·ªçn ng√¥n ng·ªØ', name:'H·ªç v√† t√™n', translateName:'D·ªãch', birthday:'Ng√†y sinh', address:'ƒê·ªãa ch·ªâ', addressSearch:'T√¨m ƒë·ªãa ch·ªâ', position:'V·ªã tr√≠', positionCustom:'T·ª± nh·∫≠p', positionSelect:'Ch·ªçn', passport:'S·ªë h·ªô chi·∫øu', phone:'S·ªë ƒëi·ªán tho·∫°i', experience:'Kinh nghi·ªám', experienceYears:'nƒÉm', signature:'Ch·ªØ k√Ω', clearSignature:'X√≥a ch·ªØ k√Ω', generate:'T·∫°o m·∫´u', complete:'‚úÖ Ho√†n th√†nh ƒëi·ªÅn', downloadTitle:'T·∫£i xu·ªëng m·∫´u', backToForm:'‚Üê Quay l·∫°i m·∫´u', generateFirst:'‚ë† T·∫£i h·ª£p ƒë·ªìng lao ƒë·ªông', generateSecond:'‚ë° T·∫£i th·ªèa thu·∫≠n an to√†n', sendToAdmin:'‚ë¢ G·ª≠i cho qu·∫£n tr·ªã vi√™n', adminMode:'Ch·∫ø ƒë·ªô qu·∫£n tr·ªã', userMode:'Ch·∫ø ƒë·ªô ng∆∞·ªùi d√πng', addressHint:'üí° T√¨m ki·∫øm ƒë·ªãa ch·ªâ tr√™n b·∫£n ƒë·ªì Naver, sau ƒë√≥ sao ch√©p v√† d√°n v√†o √¥ nh·∫≠p', downloadHint:'Vui l√≤ng t·∫£i xu·ªëng hai m·∫´u theo th·ª© t·ª±, sau ƒë√≥ g·ª≠i cho qu·∫£n tr·ªã vi√™n' },
      ru:{ title:'–§–æ—Ä–º–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ', selectLanguage:'–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫', name:'–§–ò–û', translateName:'–ü–µ—Ä–µ–≤–æ–¥', birthday:'–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è', address:'–ê–¥—Ä–µ—Å', addressSearch:'–ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞', position:'–î–æ–ª–∂–Ω–æ—Å—Ç—å', positionCustom:'–í–≤–µ—Å—Ç–∏', positionSelect:'–í—ã–±—Ä–∞—Ç—å', passport:'–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞', phone:'–¢–µ–ª–µ—Ñ–æ–Ω', experience:'–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã', experienceYears:'–ª–µ—Ç', signature:'–ü–æ–¥–ø–∏—Å—å', clearSignature:'–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å—å', generate:'–°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ä–º—É', complete:'‚úÖ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', downloadTitle:'–°–∫–∞—á–∞—Ç—å —Ñ–æ—Ä–º—ã', backToForm:'‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ñ–æ—Ä–º–µ', generateFirst:'‚ë† –°–∫–∞—á–∞—Ç—å —Ç—Ä—É–¥–æ–≤–æ–π –¥–æ–≥–æ–≤–æ—Ä', generateSecond:'‚ë° –°–∫–∞—á–∞—Ç—å —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏', sendToAdmin:'‚ë¢ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É', adminMode:'–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', userMode:'–†–µ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', addressHint:'üí° –ù–∞–π–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ Naver, –∑–∞—Ç–µ–º —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞', downloadHint:'–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–≤–µ —Ñ–æ—Ä–º—ã –ø–æ –ø–æ—Ä—è–¥–∫—É, –∞ –∑–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É' }
    };

    const positionOptions = {
      zh:['Êï¥ÁêÜ','ËÄÅÁÇÆ','ÊãÜÈô§','Èí¢Á≠ã','ÊµáÁ≠ë','Êû∂Â≠êÂ∑•','‰ø°Âè∑Âëò','‰∫åÁÇÆ','Èí¢ÁÇÆ','Á¢éÁü≥ÊäπÁÅ∞','ÂÆâÂÖ®'],
      ko:['Ï†ïÎ¶¨','ÌòïÌãÄ','Ìï¥Ï≤¥','Ï≤†Í∑º','ÌÉÄÏÑ§','ÎπÑÍ≥Ñ','Ïã†Ìò∏Ïàò','ÏïåÌèº','Í∞±Ìèº','Ìï†ÏÑùÎØ∏Ïû•','ÏïàÏ†Ñ'],
      vi:['D·ªçn d·∫πp','V√°n khu√¥n','Ph√° d·ª°','C·ªët th√©p','ƒê·ªï b√™ t√¥ng','Gi√†n gi√°o','Nh√¢n vi√™n t√≠n hi·ªáu','V√°n khu√¥n nh√¥m','V√°n khu√¥n l·ªõn','Tr√°t ƒë√° nghi·ªÅn','An to√†n'],
      ru:['–£–±–æ—Ä–∫–∞','–û–ø–∞–ª—É–±–∫–∞','–î–µ–º–æ–Ω—Ç–∞–∂','–ê—Ä–º–∞—Ç—É—Ä–∞','–ó–∞–ª–∏–≤–∫–∞','–õ–µ—Å–∞','–°–∏–≥–Ω–∞–ª—å—â–∏–∫','–ê–ª—é–º–∏–Ω–∏–µ–≤–∞—è –æ–ø–∞–ª—É–±–∫–∞','–ö—Ä—É–ø–Ω–æ—â–∏—Ç–æ–≤–∞—è –æ–ø–∞–ª—É–±–∫–∞','–®—Ç—É–∫–∞—Ç—É—Ä–∫–∞ —â–µ–±–Ω–µ–º','–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å']
    };

    const positionMapping = {
      // ‰∏≠Êñá ‚Üí Èü©Êñá
      'Êï¥ÁêÜ':'Ï†ïÎ¶¨','ËÄÅÁÇÆ':'ÌòïÌãÄ','ÊãÜÈô§':'Ìï¥Ï≤¥','Èí¢Á≠ã':'Ï≤†Í∑º','ÊµáÁ≠ë':'ÌÉÄÏÑ§','Êû∂Â≠êÂ∑•':'ÎπÑÍ≥Ñ','‰ø°Âè∑Âëò':'Ïã†Ìò∏Ïàò','‰∫åÁÇÆ':'ÏïåÌèº','Èí¢ÁÇÆ':'Í∞±Ìèº','Á¢éÁü≥ÊäπÁÅ∞':'Ìï†ÏÑùÎØ∏Ïû•','ÂÆâÂÖ®':'ÏïàÏ†Ñ',
      // Ë∂äÂçóÊñá ‚Üí Èü©Êñá
      'D·ªçn d·∫πp':'Ï†ïÎ¶¨','V√°n khu√¥n':'ÌòïÌãÄ','Ph√° d·ª°':'Ìï¥Ï≤¥','C·ªët th√©p':'Ï≤†Í∑º','ƒê·ªï b√™ t√¥ng':'ÌÉÄÏÑ§','Gi√†n gi√°o':'ÎπÑÍ≥Ñ','Nh√¢n vi√™n t√≠n hi·ªáu':'Ïã†Ìò∏Ïàò','V√°n khu√¥n nh√¥m':'ÏïåÌèº','V√°n khu√¥n l·ªõn':'Í∞±Ìèº','Tr√°t ƒë√° nghi·ªÅn':'Ìï†ÏÑùÎØ∏Ïû•','An to√†n':'ÏïàÏ†Ñ',
      // ‰øÑÊñá ‚Üí Èü©Êñá
      '–£–±–æ—Ä–∫–∞':'Ï†ïÎ¶¨','–û–ø–∞–ª—É–±–∫–∞':'ÌòïÌãÄ','–î–µ–º–æ–Ω—Ç–∞–∂':'Ìï¥Ï≤¥','–ê—Ä–º–∞—Ç—É—Ä–∞':'Ï≤†Í∑º','–ó–∞–ª–∏–≤–∫–∞':'ÌÉÄÏÑ§','–õ–µ—Å–∞':'ÎπÑÍ≥Ñ','–°–∏–≥–Ω–∞–ª—å—â–∏–∫':'Ïã†Ìò∏Ïàò','–ê–ª—é–º–∏–Ω–∏–µ–≤–∞—è –æ–ø–∞–ª—É–±–∫–∞':'ÏïåÌèº','–ö—Ä—É–ø–Ω–æ—â–∏—Ç–æ–≤–∞—è –æ–ø–∞–ª—É–±–∫–∞':'Í∞±Ìèº','–®—Ç—É–∫–∞—Ç—É—Ä–∫–∞ —â–µ–±–Ω–µ–º':'Ìï†ÏÑùÎØ∏Ïû•','–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å':'ÏïàÏ†Ñ'
    };
    function convertPositionToKorean(p){ return positionMapping[p] || p; }

    // ===================== ÂêçÂ≠óÁøªËØëÂäüËÉΩ =====================
    // ‰∏≠ÊñáÂ∏∏ËßÅÂ≠óÂà∞Èü©ËØ≠ÁöÑÊò†Â∞Ñ
    const chineseToKorean = {
      'Êùé':'Ïù¥','Áéã':'Ïôï','Âº†':'Ïû•','Âàò':'Ïú†','Èôà':'ÏßÑ','Êù®':'Ïñë','ÈªÑ':'Ìô©','Ëµµ':'Ï°∞','Âê¥':'Ïò§','Âë®':'Ï£º',
      'Âæê':'ÏÑú','Â≠ô':'ÏÜê','È©¨':'Îßà','Êú±':'Ï£º','ËÉ°':'Ìò∏','ÈÉ≠':'Í≥Ω','‰Ωï':'Ìïò','È´ò':'Í≥†','Êûó':'Î¶º','ÈÉë':'Ï†ï',
      'Â∞è':'ÏÜå','Â§ß':'ÎåÄ','Êòé':'Î™Ö','Âçé':'Ìôî','‰∏ú':'Îèô','Êñá':'Î¨∏','Âª∫':'Í±¥','ÂõΩ':'Íµ≠','ÂÜõ':'Íµ∞','Âº∫':'Í∞ï',
      '‰ºü':'ÏúÑ','Âãá':'Ïö©','Á£ä':'Î¢∞','Ê∂õ':'ÎèÑ','Èπè':'Î∂ï','Êù∞':'Í±∏','Â≥∞':'Î¥â','Ë∂Ö':'Ï¥à','Ê≥¢':'Ìåå','Ëæâ':'Ìúò',
      'Âàö':'Í∞ï','Âπ≥':'Ìèâ','È£û':'ÎπÑ','ÂÆá':'Ïö∞','Êµ©':'Ìò∏','Âøó':'ÏßÄ','‰∫Æ':'Ïñë','ÂáØ':'Í∞ú','Èæô':'Ïö©','Êò•':'Ï∂ò',
      'Êµ∑':'Ìï¥','Êñå':'Îπà','Êñ∞':'Ïã†','Êô®':'Ïã†','Èõ∑':'Î¢∞','ÂÅ•':'Í±¥','Êàê':'ÏÑ±','Èë´':'Ïã†','ÂÆÅ':'Îãù','Èùô':'Ï†ï',
      '‰∏Ω':'Î†§','Ëä≥':'Î∞©','Ááï':'Ïó∞','Â®ü':'Ïó∞','Á∫¢':'Ìôç','Èúû':'Ìïò','ÁßÄ':'Ïàò','Áé≤':'Î†π','Ê¢Ö':'Îß§','ÂÖ∞':'ÎûÄ',
      'Áæé':'ÎØ∏','Â©∑':'Ï†ï','ÂÄ©':'Ï≤ú','Êïè':'ÎØº','Ëéâ':'Î¶¨','Ëã±':'ÏòÅ','‰∫ë':'Ïö¥','ÊÖß':'Ìòú','È¢ñ':'ÏòÅ','Ëêç':'Ìèâ',
      'Ê¥Å':'Í≤∞','‰Ω≥':'Í∞Ä','Áê≥':'Î¶º','Èõ™':'ÏÑ§','Ëèä':'Íµ≠','Ëâ≥':'Ïóº','Êúà':'Ïõî','Âá§':'Î¥â','Êô∂':'Ï†ï','‰∏π':'Îã®',
      '‰∫¨':'Í≤Ω','ÂÆâ':'Ïïà','Á¶è':'Î≥µ','Á••':'ÏÉÅ','Ê≠¶':'Î¨¥','Ê∏Ö':'Ï≤≠','Ê≠£':'Ï†ï','‰ªÅ':'Ïù∏','‰πâ':'Ïùò','Âæ∑':'Îçï',
      'Êùæ':'ÏÜ°','Ê±ü':'Í∞ï','Â±±':'ÏÇ∞','Èùí':'Ï≤≠','Âèã':'Ïö∞','Ë¥µ':'Í∑Ä','ÂÖ¥':'Ìù•','ÊåØ':'ÏßÑ','Êôì':'Ìö®','‰∫ö':'ÏïÑ',
      'Ê∞∏':'ÏòÅ','ÂÖÉ':'Ïõê','Èïø':'Ïû•','‰∏ñ':'ÏÑ∏','‰∏≠':'Ï§ë','Â§©':'Ï≤ú','ÂÆù':'Î≥¥','Áîü':'ÏÉù','Âø†':'Ï∂©','ËÉú':'Ïäπ',
      'Êó∂':'Ïãú','ÊÄù':'ÏÇ¨','ÂÖâ':'Í¥ë','Âçó':'ÎÇ®','Âåó':'Î∂Å','Êñπ':'Î∞©','Â≠ê':'Ïûê','Ê∞ë':'ÎØº','Áéâ':'Ïò•','Ê†ë':'Ïàò',
      'Êâç':'Ïû¨','Êúâ':'Ïú†','ÂÆ∂':'Í∞Ä','‰∏ö':'ÏóÖ','Â≠¶':'Ìïô','Âà©':'Î¶¨','Âíå':'Ìôî','Á´ã':'Î¶Ω','Ëææ':'Îã¨','Èáë':'ÍπÄ',
      'Âäõ':'Î†•','Ë¥§':'ÌòÑ','Êòæ':'ÌòÑ','ÈõÖ':'ÏïÑ','‰πê':'ÎùΩ','ÂØå':'Î∂Ä','Ë±™':'Ìò∏','Ê≥Ω':'ÌÉù','Èîã':'Î¥â','Ê∂µ':'Ìï®',
      '‰øä':'Ï§Ä','Áøî':'ÏÉÅ','Âçö':'Î∞ï','Ëøú':'Ïõê','‰π¶':'ÏÑú','ÂêØ':'Í≥Ñ','Áª¥':'Ïú†','ÈÅì':'ÎèÑ','Èî¶':'Í∏à','Ëç£':'ÏòÅ',
      'Êòü':'ÏÑ±','Èì∂':'ÏùÄ','ÈìÅ':'Ï≤†','Èìú':'Îèô','Èí¢':'Í∞ï','Áü≥':'ÏÑù','Ê∞¥':'Ïàò','ÁÅ´':'Ìôî','È£é':'Ìíç','Èõ®':'Ïö∞',
      'Ëä±':'Ìôî','Ëçâ':'Ï¥à','Êûó':'Î¶º','Ê£Æ':'ÏÇº','ËåÇ':'Î¨¥','Ëç£':'ÏòÅ','Âçé':'Ìôî','ÂØå':'Î∂Ä','Ë¥µ':'Í∑Ä','Â∫∑':'Í∞ï',
      'Ê≥∞':'ÌÉú','ÂÆâ':'Ïïà','‰πê':'ÎùΩ','ÂØø':'Ïàò','Âêâ':'Í∏∏','Á••':'ÏÉÅ','Á¶è':'Î≥µ','Á¶Ñ':'ÎÖπ','Âñú':'Ìù¨','Â∫Ü':'Í≤Ω',
      'Âèë':'Î∞ú','Ë¥¢':'Ïû¨','Ëøõ':'ÏßÑ','Âçá':'Ïäπ','Áôª':'Îì±','È´ò':'Í≥†','Ëøú':'Ïõê','Â§ß':'ÎåÄ','Âπø':'Í¥ë','ÂÆè':'Ìôç',
      '‰øê':'Î¶¨','Â®ú':'ÎÇò','Â©â':'ÏôÑ','Êüî':'Ïú†','Ê∏©':'Ïò®','Ê∑ë':'Ïàô','Á´Ø':'Îã®','Ë¥û':'Ï†ï','Ê¥™':'Ìôç','Ê±â':'Ìïú',
      'Áà±':'Ïï†','‰ªô':'ÏÑ†','Âá°':'Î≤î','ÂÜ∞':'Îπô','ÂøÉ':'Ïã¨','ÊÄ°':'Ïù¥','ÊÉ†':'Ìòú','Áèç':'ÏßÑ','Áê™':'Í∏∞','Áëû':'ÏÑú',
      'Áíá':'ÏÑ†','Áë∂':'Ïöî','ÁéØ':'Ìôò','ÁïÖ':'Ï∞Ω','Áúü':'ÏßÑ','Á•∫':'Í∏∞','Á´π':'Ï£Ω','Á¨ë':'ÏÜå','Á≠±':'ÏÜå','Á∫Ø':'Ïàú',
      'ÁªÆ':'Í∏∞','Áø†':'Ï∑®','ËÅ™':'Ï¥ù','Ëâ∫':'Ïòà','Ëä¨':'Î∂Ñ','Ëä∏':'Ïö¥','Ëã•':'ÏïΩ','Ëéπ':'ÏòÅ','ËèÅ':'Ï†ï','Ëêå':'Îßπ',
      'Ëôπ':'Ìôç','Ëù∂':'Ï†ë','ËØó':'Ïãú','ËØ≠':'Ïñ¥','Ë¥∫':'Ìïò','Ë∂ä':'Ïõî','Ëøé':'ÏòÅ','Ëøû':'Î†®','ÈÇ¶':'Î∞©','ÈÇë':'Ïùç',
      'Èáá':'Ï±Ñ','Èì∂':'ÏùÄ','Èîê':'Ïòà','Èôµ':'Î¶â','Èúñ':'Î¶º','Èùñ':'Ï†ï','Èùô':'Ï†ï','Èüµ':'Ïö¥','È¢Ç':'ÏÜ°','È∏ø':'Ìôç',
      'ÂÆΩ':'Í¥Ä','Âéö':'ÌõÑ','ÂñÑ':'ÏÑ†','‰ª™':'Ïùò','ÂÆπ':'Ïö©','ÂÆú':'Ïùò','ÂØí':'Ìïú','Âª∑':'Ï†ï','Âª∂':'Ïó∞','ÂºÄ':'Í∞ú',
      'ÊÅ©':'ÏùÄ','ÊÖà':'Ïûê','Êáø':'Ïùò','Êàà':'Í≥º','Êâç':'Ïû¨','Êâø':'Ïäπ','Êãì':'ÌÉÅ','Êï¨':'Í≤Ω','Êï¶':'Îèà','ÊñØ':'ÏÇ¨',
      'Êó≠':'Ïö±','Êòä':'Ìò∏','Êòå':'Ï∞Ω','Êò≠':'ÏÜå','Êô∫':'ÏßÄ','Êöñ':'ÎÇú','Êõô':'ÏÑú','Êúó':'Îûë','Êú®':'Î™©','Êú¨':'Î≥∏',
      'ÊùÉ':'Í∂å','Êüè':'Î∞±','Ê†ã':'Îèô','Ê¢Å':'Ïñë','Ê•†':'ÎÇ®','Ê¨£':'Ìùî','Ê¨¢':'Ìôò','Ê≠å':'Í∞Ä','ÊØÖ':'Ïùò','Ê±ù':'Ïó¨',
      'Ê≤õ':'Ìå®','Ê≤≥':'Ìïò','Ê≥â':'Ï≤ú','Ê¥ã':'Ïñë','Êµö':'Ï§Ä','Ê∑≥':'Ïàú','Ê∑±':'Ïã¨','Ê∏ä':'Ïó∞','Ê∫ê':'Ïõê','Ê∫™':'Í≥Ñ',
      'Êª®':'Îπà','ÊæÑ':'Ïßï','ÁÄö':'Ìïú','ÁÇé':'Ïóº','ÁÉ®':'ÏóΩ','ÁÖä':'Ìõ§','ÁÜô':'Ìù¨','Ááä':'Ïã†','Áâß':'Î™©','ÁêÜ':'Î¶¨',
      'Áêõ':'Ïπ®','Áëú':'Ïú†','Áíã':'Ïû•','Áíê':'Î°ú','Áî´':'Î≥¥','Áî∞':'Ï†Ñ','ÁïÖ':'Ï∞Ω','Áôæ':'Î∞±','Áõõ':'ÏÑ±','Áùø':'Ïòà',
      'Áü•':'ÏßÄ','Á§º':'Î°Ä','Á¶π':'Ïö∞','Áßë':'Í≥º','Áßã':'Ï∂î','Á®ã':'Ï†ï','Á©Ü':'Î™©','Á´Ø':'Îã®','Á≠ñ':'Ï±Ö','Á≠†':'Í∑†',
      'ÁÆÄ':'Í∞Ñ','Á±≥':'ÎØ∏','Á≤æ':'Ï†ï','Áªç':'ÏÜå','Áªß':'Í≥Ñ','Áª¥':'Ïú†','Áªµ':'Î©¥','Áºò':'Ïó∞','Áø∞':'Ìïú','Áøº':'Ïùµ',
      'ËÖæ':'Îì±','ËâØ':'Ïñë','Ëäù':'ÏßÄ','Ëãó':'Î¨ò','Ëåπ':'Ïó¨','Ëåµ':'Ïù∏','ËçÉ':'Ï†Ñ','Ëç∑':'Ìïò','Ëçª':'Ï†Å','Ëè≤':'ÎπÑ',
      'Ëê±':'Ìõ§','Ëëµ':'Í∑ú','Ëìâ':'Ïö©','Ëîö':'ÏúÑ','Ëïä':'Ïòà','Ëïæ':'Î¢∞','Ëñá':'ÎØ∏','Ëó§':'Îì±','Ëûç':'Ïúµ','Ë°å':'Ìñâ',
      'Ë°°':'Ìòï','Ë£ï':'Ïú†','Ë•ø':'ÏÑú','Ë¶Å':'Ïöî','ËßÅ':'Í≤¨','Ë®Ä':'Ïñ∏','ËÆ°':'Í≥Ñ','ËÆ∞':'Í∏∞','ËÆ≠':'Ìõà','ËØö':'ÏÑ±',
      'Ë∞ä':'Ïùò','Ë∞¶':'Í≤∏','Ë±´':'Ïòà','Ë¥û':'Ï†ï','Ë∑É':'ÏïΩ','ËΩ©':'Ìóå','Ëæ∞':'Ïã†','Ëø™':'Ï†Å','ÈÄ∏':'Ïùº','ÈÅ•':'Ïöî',
      'ÈÇµ':'ÏÜå','ÈÇª':'Î¶∞','ÈÉÅ':'Ïö±','ÈÉΩ':'ÎèÑ','Èâ¥':'Í∞ê','Èî°':'ÏÑù','Èî¶':'Í∏à','Èïá':'ÏßÑ','Èï≠':'Î¢∞','Èóª':'Î¨∏',
      'Èòî':'Ìôú','Èò≥':'Ïñë','ÈôÖ':'Ï†ú','ÈöÜ':'Î•≠','ÈõÅ':'Ïïà','ÈõÜ':'Ïßë','ÈúÑ':'ÏÜå','ÈúÅ':'Ï†ú','Èùí':'Ï≤≠','Èü¨':'ÎèÑ',
      'È°∫':'Ïàú','È¢Ç':'ÏÜ°','È£é':'Ìíç','È£í':'ÏÇ¥','È¶®':'Ìòï','È™è':'Ï§Ä','È≠Å':'Í¥¥','È∏£':'Î™Ö','Èπ§':'Ìïô','Èπè':'Î∂ï',
      'È∫í':'Í∏∞','È∫ü':'Î¶∞','Èªé':'Î†§','ÈΩê':'Ï†ú'
    };

    // Ë∂äÂçóËØ≠Èü≥ËäÇÂà∞Èü©ËØ≠ÁöÑÊò†Â∞Ñ
    const vietnameseToKorean = {
      // Â£∞ÊØç
      'Ph':'ÌîÑ','Th':'Ìä∏','Kh':'ÌÅ¨','Tr':'ÏØî','Ng':'Ïùë','Nh':'Îäê','Ch':'ÏØî','Gi':'ÏßÄ','Qu':'Íæ∏',
      // Â∏∏ËßÅÈü≥ËäÇ
      'Ph·∫°m':'Ìåú','Nguy·ªÖn':'ÏùëÏö∞Ïòå','Tr·∫ßn':'Ï©ê','L√™':'Î†à','Ho√†ng':'Ìò∏Ïïô','Phan':'Ìåê','V≈©':'Î∂Ä','ƒê·∫∑ng':'Îãπ',
      'B√πi':'Î∂ÄÏù¥','ƒê·ªó':'ÎèÑ','H·ªì':'Ìò∏','Ng√¥':'ÏùëÏò§','D∆∞∆°ng':'Ï¶àÏóâ','L√Ω':'Î¶¨',
      // ÂêçÂ≠óÂ∏∏ËßÅÈü≥ËäÇ
      'Anh':'Ïïà','Tu·∫•n':'ÎëêÏïà','H√πng':'Ìõô','D≈©ng':'Ï§ë','Minh':'ÎØº','Quang':'ÍΩù','Th√†nh':'ÌÉÄÏù∏',
      'VƒÉn':'Î∞ò','H·∫£i':'ÌïòÏù¥','ƒê·ª©c':'Îìù','Huy':'Ìúò','Nam':'ÎÇ®','Long':'Î°±','Ho√†ng':'Ìò∏Ïïô',
      'Th·ªã':'Ìã∞','Th√∫y':'Ìà¨Ïù¥','Linh':'Î¶∞','Mai':'ÎßàÏù¥','Lan':'ÎûÄ','Hoa':'Ìò∏ÏïÑ','Nga':'ÏùëÏïÑ',
      'Thi':'Ìã∞','Van':'Î∞ò','Tuan':'ÎëêÏïà','Hung':'Ìõô','Dung':'Ï§ë','Thanh':'ÌÉÄÏù∏','Hai':'ÌïòÏù¥',
      // ÂçïÈü≥ËäÇ
      'a':'ÏïÑ','e':'Ïóê','i':'Ïù¥','o':'Ïò§','u':'Ïö∞','√¥':'Ïñ¥','∆°':'Ïñ¥','∆∞':'Ïúº',
      'An':'Ïïà','Ba':'Î∞î','Ca':'Íπå','Da':'Îã§','Ga':'Í∞Ä','Ha':'Ìïò','La':'Îùº','Ma':'Îßà',
      'Na':'ÎÇò','Pa':'Îπ†','Ta':'Îî∞','Va':'Î∞î','Xa':'Ïã∏','Ya':'Ïïº'
    };

    // ‰øÑËØ≠Â≠óÊØçÂà∞Èü©ËØ≠ÁöÑÊò†Â∞Ñ
    const russianToKorean = {
      '–ê':'ÏïÑ','–ë':'Î∏å','–í':'Î∏å','–ì':'Í∑∏','–î':'Îìú','–ï':'Ïòà','–Å':'Ïöî','–ñ':'Ï¶à','–ó':'Ï¶à',
      '–ò':'Ïù¥','–ô':'Ïù¥','–ö':'ÌÅ¨','–õ':'–ª—å','–ú':'ÎØÄ','–ù':'Îäê','–û':'Ïò§','–ü':'ÌîÑ','–†':'Î•¥',
      '–°':'Ïä§','–¢':'Ìä∏','–£':'Ïö∞','–§':'ÌîÑ','–•':'Ìùê','–¶':'Ï∏†','–ß':'Ï∏†','–®':'Ïâ¨','–©':'Ïãú',
      '–™':'','–´':'ÏúºÏù¥','–¨':'','–≠':'Ïóê','–Æ':'Ïú†','–Ø':'Ïïº',
      '–∞':'ÏïÑ','–±':'Î∏å','–≤':'Î∏å','–≥':'Í∑∏','–¥':'Îìú','–µ':'Ïòà','—ë':'Ïöî','–∂':'Ï¶à','–∑':'Ï¶à',
      '–∏':'Ïù¥','–π':'Ïù¥','–∫':'ÌÅ¨','–ª':'–ª—å','–º':'ÎØÄ','–Ω':'Îäê','–æ':'Ïò§','–ø':'ÌîÑ','—Ä':'Î•¥',
      '—Å':'Ïä§','—Ç':'Ìä∏','—É':'Ïö∞','—Ñ':'ÌîÑ','—Ö':'Ìùê','—Ü':'Ï∏†','—á':'Ï∏†','—à':'Ïâ¨','—â':'Ïãú',
      '—ä':'','—ã':'ÏúºÏù¥','—å':'','—ç':'Ïóê','—é':'Ïú†','—è':'Ïïº'
    };

    // Â∞ÜÂ≠óÂÖ∏ÂØπË±°ÊåÇËΩΩÂà∞window‰∏äÔºå‰ΩøÂÖ∂ÂèØ‰ª•Ë¢´Â§ñÈÉ®JSONÊñá‰ª∂Êõ¥Êñ∞
    window.chineseToKorean = chineseToKorean;
    window.vietnameseToKorean = vietnameseToKorean;
    window.russianToKorean = russianToKorean;
    
    // ‰øÑÊñáÂÆåÊï¥ÂêçÂ≠ó„ÄÅÂêéÁºÄËßÑÂàôÂíåÈõÜÁæ§ËßÑÂàôÔºà‰ªéJSONÂä†ËΩΩÂêéÂ°´ÂÖÖÔºâ
    window.russianUnits = {};
    window.russianSuffix = {};
    window.russianCluster = [];
    
    // ÊîπËøõÁöÑ‰øÑÊñáÂêçÂ≠óÁøªËØëÂáΩÊï∞
    function translateRussianName(name) {
      // 1. È¶ñÂÖàÂ∞ùËØïÂÆåÊï¥ÂåπÈÖç
      if (window.russianUnits && window.russianUnits[name]) {
        return window.russianUnits[name];
      }
      
      // 2. Â∞ùËØïÂêéÁºÄËßÑÂàôÂåπÈÖç
      if (window.russianSuffix && Object.keys(window.russianSuffix).length > 0) {
        for (const [suffix, replacement] of Object.entries(window.russianSuffix)) {
          if (name.endsWith(suffix)) {
            const base = name.slice(0, -suffix.length);
            // Â∞ùËØïÂåπÈÖçÂü∫Á°ÄÈÉ®ÂàÜ
            if (window.russianUnits && window.russianUnits[base]) {
              return window.russianUnits[base] + replacement;
            }
            // ÈÄíÂΩíÁøªËØëbaseÈÉ®ÂàÜ
            return translateRussianName(base) + replacement;
          }
        }
      }
      
      // 3. Â∞ùËØïÈõÜÁæ§ËßÑÂàôÂåπÈÖç
      if (window.russianCluster && window.russianCluster.length > 0) {
        let result = name;
        for (const [pattern, replacement] of window.russianCluster) {
          result = result.replace(new RegExp(pattern, 'g'), replacement);
        }
        if (result !== name) {
          return result;
        }
      }
      
      // 4. ÈÄêÂ≠óÁ¨¶ÁøªËØëÔºàÂõûÈÄÄÊñπÊ°àÔºâ
      let result = '';
      for(let char of name){
        if(char === ' ') result += '';
        else result += russianToKorean[char] || char;
      }
      return result;
    }

    function translateName(){
      const name = state.formData['name'];
      if(!name || !name.trim()){
        alert('ËØ∑ÂÖàËæìÂÖ•ÂßìÂêç / Ïù¥Î¶ÑÏùÑ Î®ºÏ†Ä ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
        return;
      }

      let translated = '';
      
      // Ê£ÄÊµãÊòØÂê¶‰∏∫‰∏≠Êñá
      if(/[\u4e00-\u9fa5]/.test(name)){
        // ‰∏≠ÊñáÁøªËØë
        for(let char of name){
          translated += chineseToKorean[char] || char;
        }
      }
      // Ê£ÄÊµãÊòØÂê¶‰∏∫Ë∂äÂçóËØ≠ÔºàÊãâ‰∏ÅÂ≠óÊØç+Â£∞Ë∞ÉÁ¨¶Âè∑Ôºâ
      else if(/[·∫†·∫¢·∫§·∫¶·∫®·∫™·∫¨·∫Æ·∫∞·∫≤·∫¥·∫∂·∫∏·∫∫·∫º·∫æ·ªÄ·ªÇ∆∞ƒÉ√™√¥∆°∆ØƒÇ√ä√î∆†]/.test(name) || /^[A-Za-z\s]+$/.test(name)){
        // Ë∂äÂçóËØ≠ÁøªËØë - ÊåâÁ©∫Ê†ºÂàÜÂâ≤
        const parts = name.split(/\s+/);
        translated = parts.map(part => {
          // ÂÖàÂ∞ùËØïÂÆåÊï¥ÂåπÈÖç
          if(vietnameseToKorean[part]) return vietnameseToKorean[part];
          
          // Â∞ùËØïÂåπÈÖçÂºÄÂ§¥ÁöÑËæÖÈü≥ÁªÑÂêà
          for(let i = 2; i >= 1; i--){
            const prefix = part.substring(0, i);
            if(vietnameseToKorean[prefix]){
              const rest = part.substring(i);
              return vietnameseToKorean[prefix] + translateVietnamesePart(rest);
            }
          }
          
          // ÈÄêÂ≠óÁ¨¶ÁøªËØë
          return translateVietnamesePart(part);
        }).join('');
      }
      // Ê£ÄÊµãÊòØÂê¶‰∏∫‰øÑËØ≠Ë•øÈáåÂ∞îÂ≠óÊØç
      else if(/[–ê-–Ø–∞-—è–Å—ë]/.test(name)){
        // ‰øÑËØ≠ÁøªËØë - ‰ΩøÁî®ÊîπËøõÁöÑÁÆóÊ≥ï
        translated = translateRussianName(name);
      }
      else {
        alert('Êó†Ê≥ïËØÜÂà´ÁöÑÂêçÂ≠óÊ†ºÂºè / Ïù¥Î¶Ñ ÌòïÏãùÏùÑ Ïù∏ÏãùÌï† Ïàò ÏóÜÏäµÎãàÎã§');
        return;
      }

      // Êõ¥Êñ∞Áä∂ÊÄÅÂπ∂ÈáçÊñ∞Ê∏≤Êüì
      state.formData['name'] = translated;
      render();
    }

    function translateVietnamesePart(str){
      let result = '';
      for(let char of str){
        const lower = char.toLowerCase();
        if(vietnameseToKorean[lower]){
          result += vietnameseToKorean[lower];
        } else if(/[aeiou√¥∆°∆∞]/.test(lower)){
          // ÂÖÉÈü≥Âü∫Êú¨Êò†Â∞Ñ
          const vowelMap = {'a':'ÏïÑ','e':'Ïóê','i':'Ïù¥','o':'Ïò§','u':'Ïö∞','√¥':'Ïñ¥','∆°':'Ïñ¥','∆∞':'Ïúº'};
          result += vowelMap[lower] || char;
        } else if(/[bcdfghjklmnpqrstvwxyz]/.test(lower)){
          // ËæÖÈü≥Âü∫Êú¨Êò†Â∞Ñ
          const consonantMap = {
            'b':'Î∏å','c':'ÎÅÑ','d':'Îìú','f':'ÌîÑ','g':'Í∑∏','h':'Ìùê','j':'Ï¶à','k':'ÌÅ¨',
            'l':'–ª—å','m':'ÎØÄ','n':'Îäê','p':'ÌîÑ','q':'ÎÅÑ','r':'Î•¥','s':'Ïä§','t':'Ìä∏',
            'v':'Î∏å','w':'Ïö∞','x':'Ïä§','y':'Ïù¥','z':'Ï¶à'
          };
          result += consonantMap[lower] || char;
        } else {
          result += char;
        }
      }
      return result;
    }
    
    // ===================== ËôöÊãüÈîÆÁõòÂäüËÉΩ =====================
    let keyboardVisible = false;
    
    function toggleKeyboard() {
      keyboardVisible = !keyboardVisible;
      render();
    }
    
    function insertChar(char) {
      const currentName = state.formData['name'] || '';
      state.formData['name'] = currentName + char;
      render();
    }
    
    function deleteLastChar() {
      const currentName = state.formData['name'] || '';
      if (currentName.length > 0) {
        state.formData['name'] = currentName.slice(0, -1);
        render();
      }
    }
    
    function clearName() {
      state.formData['name'] = '';
      render();
    }
    
    function getKeyboardChars() {
      const lang = state.language;
      if (lang === 'zh') {
        // ‰∏≠ÊñáÂ∏∏Áî®Â≠ó
        return Object.keys(window.chineseToKorean).slice(0, 200);
      } else if (lang === 'vi') {
        // Ë∂äÂçóÊñáÂ∏∏Áî®Â≠óÊØçÁªÑÂêà
        return Object.keys(window.vietnameseToKorean).slice(0, 200);
      } else if (lang === 'ru') {
        // ‰øÑÊñáÂ≠óÊØç
        const russianAlphabet = [
          '–ê','–ë','–í','–ì','–î','–ï','–Å','–ñ','–ó','–ò','–ô','–ö','–õ','–ú','–ù','–û','–ü','–†','–°','–¢','–£','–§','–•','–¶','–ß','–®','–©','–™','–´','–¨','–≠','–Æ','–Ø',
          '–∞','–±','–≤','–≥','–¥','–µ','—ë','–∂','–∑','–∏','–π','–∫','–ª','–º','–Ω','–æ','–ø','—Ä','—Å','—Ç','—É','—Ñ','—Ö','—Ü','—á','—à','—â','—ä','—ã','—å','—ç','—é','—è'
        ];
        return russianAlphabet;
      }
      return [];
    }

    // ===================== Â∫îÁî®Áä∂ÊÄÅ =====================
    let state = {
      language:'zh',
      formData:{},
      signature:null,
      isDrawing:false,
      isAdminMode:false,
      showPasswordPage:false,
      showDownloadPage:false,
      formsGenerated:false,
      firstFormGenerated:false,
      secondFormGenerated:false,
      templates:{ contract:{ zh:null, ko:null }, safety:{ zh:null, ko:null } },
      fieldPositions:{ contract:{ zh:{}, ko:{} }, safety:{ zh:{}, ko:{} } },
      currentTemplate:'contract',
      currentLang:'zh',
      selectedField:null,
      editingField:null,
      multiInstanceMode:false,
      repositionTarget:null,
      positionMode:'select'
    };

    // ===================== Âº∫Âà∂‰ªéJSONÂä†ËΩΩÈÖçÁΩÆ =====================
    async function loadDefaultConfig(){
      try{
        const res = await fetch('form-config.json');
        if(res.ok){
          const config = await res.json();
          if(config.templates) state.templates = config.templates;
          if(config.fieldPositions) state.fieldPositions = config.fieldPositions;
          return true;
        }
      }catch(e){ 
        console.error('Âä†ËΩΩform-config.jsonÂ§±Ë¥•:', e); 
      }
      return false;
    }

    function saveToLocalStorage(){
      // Â∑≤Á¶ÅÁî® - Âº∫Âà∂‰ΩøÁî®JSONÈÖçÁΩÆ
    }

    async function initConfig(){
      await loadDefaultConfig();  // Âº∫Âà∂Âè™‰ΩøÁî®JSONÈÖçÁΩÆ
      render();
    }

    // ===================== Â∑•ÂÖ∑ÂáΩÊï∞ =====================
    function getFieldsList(lang){
      if(lang==='ko'){ return ['name','birthday','address','residentNum','phone','position','experience','month','day','checkmark','signature']; }
      return ['name','birthday','address','position','passport','phone','experience','month','day','checkmark','signature'];
    }
    function getCurrentMonth(){ return String(new Date().getMonth()+1); }
    function getCurrentDay(){ return String(new Date().getDate()); }

    // üëâ ÁßªÂä®Á´ØÂÖºÂÆπ‰∏ãËΩΩÔºàÊ†∏ÂøÉ‰øÆÂ§çÁÇπÔºâ
    function safeDownloadFromBlob(blob, filename){
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.style.display = 'none';
      document.body.appendChild(a);
      
      // Ëß¶Âèë‰∏ãËΩΩ - ÁßªÂä®Á´ØÂíåÊ°åÈù¢Á´ØÁªü‰∏ÄÂ§ÑÁêÜ
      try {
        a.click();
      } catch(e) {
        // Â¶ÇÊûúclick()Â§±Ë¥•ÔºåÂ∞ùËØïËß¶ÂèëËß¶Êë∏‰∫ã‰ª∂
        const evt = new MouseEvent('click', {
          view: window,
          bubbles: true,
          cancelable: true
        });
        a.dispatchEvent(evt);
      }
      
      // Âª∂ËøüÁßªÈô§ÂÖÉÁ¥†ÂíåÈáäÊîæURLÔºåÁªôÊµèËßàÂô®Ë∂≥Â§üÊó∂Èó¥Â§ÑÁêÜ‰∏ãËΩΩ
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 2000);
    }

    // ===================== Á≠æÂêçÊùø =====================
    let signatureCanvas=null, sigCtx=null;
    function startDrawing(e){
      const rect = signatureCanvas.getBoundingClientRect();
      // ËÆ°ÁÆóÊòæÁ§∫Â∞∫ÂØ∏ÂíåÂÆûÈôÖcanvasÂ∞∫ÂØ∏ÁöÑÊØî‰æã
      const scaleX = signatureCanvas.width / rect.width;
      const scaleY = signatureCanvas.height / rect.height;
      // Ëé∑ÂèñËß¶Êë∏/Èº†Ê†á‰ΩçÁΩÆÂπ∂ÊåâÊØî‰æãÁº©Êîæ
      const x = ((e.clientX || e.touches?.[0]?.clientX) - rect.left) * scaleX;
      const y = ((e.clientY || e.touches?.[0]?.clientY) - rect.top) * scaleY;
      sigCtx.beginPath(); sigCtx.moveTo(x,y); state.isDrawing=true;
    }
    function draw(e){
      if(!state.isDrawing) return;
      e.preventDefault();
      const rect = signatureCanvas.getBoundingClientRect();
      // ËÆ°ÁÆóÊòæÁ§∫Â∞∫ÂØ∏ÂíåÂÆûÈôÖcanvasÂ∞∫ÂØ∏ÁöÑÊØî‰æã
      const scaleX = signatureCanvas.width / rect.width;
      const scaleY = signatureCanvas.height / rect.height;
      // Ëé∑ÂèñËß¶Êë∏/Èº†Ê†á‰ΩçÁΩÆÂπ∂ÊåâÊØî‰æãÁº©Êîæ
      const x = ((e.clientX || e.touches?.[0]?.clientX) - rect.left) * scaleX;
      const y = ((e.clientY || e.touches?.[0]?.clientY) - rect.top) * scaleY;
      sigCtx.lineTo(x,y); sigCtx.stroke();
    }
    function stopDrawing(){
      if(state.isDrawing){ state.isDrawing=false; state.signature = signatureCanvas.toDataURL(); }
    }
    function clearSignature(){ sigCtx.clearRect(0,0,signatureCanvas.width, signatureCanvas.height); state.signature=null; }

    // ===================== ÁîüÊàêË°®Âçï =====================
    function completeFillForm(){
      // Ê£ÄÊü•Á≠æÂêç
      if(!state.signature){
        const messages = { 
          zh:'ËØ∑ÂÖàÁ≠æÂêç', 
          ko:'ÏÑúÎ™ÖÏùÑ Ìï¥Ï£ºÏÑ∏Ïöî', 
          vi:'Vui l√≤ng k√Ω t√™n', 
          ru:'–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–ø–∏—à–∏—Ç–µ' 
        };
        alert(messages[state.language] || 'ËØ∑ÂÖàÁ≠æÂêç');
        return;
      }
      
      // Ëé∑ÂèñÂΩìÂâçËØ≠Ë®ÄÈúÄË¶ÅÁöÑÂøÖÂ°´Â≠óÊÆµ
      const requiredFields = getFieldsList(state.language).filter(f=>!['signature','month','day','checkmark'].includes(f));
      
      // Â≠óÊÆµÂêçÁß∞Êò†Â∞ÑÔºàÁî®‰∫éÈîôËØØÊèêÁ§∫Ôºâ
      const t = translations[state.language];
      const fieldNames = {
        name: t.name,
        birthday: t.birthday,
        address: t.address,
        position: t.position,
        passport: t.passport,
        residentNum: 'Ï£ºÎØºÎì±Î°ùÎ≤àÌò∏',
        phone: t.phone,
        experience: t.experience
      };
      
      // Ê£ÄÊü•ÊØè‰∏™ÂøÖÂ°´Â≠óÊÆµ
      const emptyFields = [];
      for(let field of requiredFields){
        if(!state.formData[field] || state.formData[field].trim() === ''){
          emptyFields.push(fieldNames[field] || field);
        }
      }
      
      // Â¶ÇÊûúÊúâÊú™Â°´ÂÜôÁöÑÂ≠óÊÆµÔºåÊòæÁ§∫ÊèêÁ§∫
      if(emptyFields.length > 0){
        const messages = {
          zh: `ËØ∑Â°´ÂÜô‰ª•‰∏ãÂøÖÂ°´È°πÔºö\n\n${emptyFields.join('\n')}`,
          ko: `Îã§Ïùå ÌïÑÏàò Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî:\n\n${emptyFields.join('\n')}`,
          vi: `Vui l√≤ng ƒëi·ªÅn c√°c m·ª•c b·∫Øt bu·ªôc sau:\n\n${emptyFields.join('\n')}`,
          ru: `–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:\n\n${emptyFields.join('\n')}`
        };
        alert(messages[state.language] || messages.zh);
        return;
      }
      
      // ÊâÄÊúâÈ™åËØÅÈÄöËøáÔºåÂàáÊç¢Âà∞‰∏ãËΩΩÈ°µÈù¢
      state.showDownloadPage = true;
      render();
    }

    async function generateFirstForm(){
      const langKey = state.language === 'ko' ? 'ko' : 'zh';
      await generateForm('contract', langKey);
      state.firstFormGenerated = true;
      
      const successMessages = { 
        zh:'‚úÖ Âä≥Âä®ÂêàÂêåÂ∑≤‰∏ãËΩΩ', 
        ko:'‚úÖ Í∑ºÎ°úÍ≥ÑÏïΩÏÑú Îã§Ïö¥Î°úÎìú ÏôÑÎ£å', 
        vi:'‚úÖ H·ª£p ƒë·ªìng lao ƒë·ªông ƒë√£ t·∫£i xu·ªëng', 
        ru:'‚úÖ –¢—Ä—É–¥–æ–≤–æ–π –¥–æ–≥–æ–≤–æ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω' 
      };
      setTimeout(() => {
        alert(successMessages[state.language] || '‚úÖ Âä≥Âä®ÂêàÂêåÂ∑≤‰∏ãËΩΩ');
        render();
      }, 300);
    }

    async function generateSecondForm(){
      const langKey = state.language === 'ko' ? 'ko' : 'zh';
      await generateForm('safety', langKey);
      state.secondFormGenerated = true;
      
      const successMessages = { 
        zh:'‚úÖ ÂÆâÂÖ®ÂçèËÆÆÂ∑≤‰∏ãËΩΩ', 
        ko:'‚úÖ ÏïàÏ†ÑÌòëÏïΩ Îã§Ïö¥Î°úÎìú ÏôÑÎ£å', 
        vi:'‚úÖ Th·ªèa thu·∫≠n an to√†n ƒë√£ t·∫£i xu·ªëng', 
        ru:'‚úÖ –°–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–æ' 
      };
      setTimeout(() => {
        alert(successMessages[state.language] || '‚úÖ ÂÆâÂÖ®ÂçèËÆÆÂ∑≤‰∏ãËΩΩ');
        render();
      }, 300);
    }

    async function generateForm(templateType, langKey){
      const template = state.templates[templateType][langKey];
      const positions = state.fieldPositions[templateType][langKey];
      if(!template || !positions || Object.keys(positions).length===0){ return; }

      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const img = new Image();

      await new Promise((resolve)=>{
        img.onload = ()=>{
          canvas.width = img.width; canvas.height = img.height;
          ctx.drawImage(img,0,0); ctx.textBaseline='top';

          // ÂÜôÂÖ•ÊñáÊú¨ - üëâ ÂÅöÊàêÂõæÁâáÊó∂ÊääÊâÄÊúâ‰ø°ÊÅØÊîπÊàêÈü©ÊñáÔºàÂπ¥ÊîπÊàêÎÖÑÔºåÂ∑•Áßç‰πüÊîπÊàêÂØπÂ∫îÂ∑•ÁßçÁöÑÈü©ÊñáÔºâ
          Object.keys(positions).forEach(key=>{
            const pos = positions[key]; if(!pos) return;
            const baseField = pos.baseField || key;
            let textValue = '';
            if(baseField==='month'){ textValue=getCurrentMonth(); }
            else if(baseField==='day'){ textValue=getCurrentDay(); }
            else if(baseField==='checkmark'){ textValue='‚úì'; }
            else if(state.formData[baseField]){
              textValue = state.formData[baseField];
              
              // üëâ Ê†∏ÂøÉ‰øÆÂ§çÔºöÁªü‰∏ÄËΩ¨Êç¢‰∏∫Èü©ÊñáÊòæÁ§∫Ôºà‰∏çÁÆ°‰ΩøÁî®‰ªÄ‰πàËØ≠Ë®ÄÁöÑÊ®°ÊùøÔºâ
              // ÁªèÈ™åÂπ¥‰ªΩÔºöÂéªÊéâ‰∏≠Êñá"Âπ¥"„ÄÅË∂äÂçóÊñá"nƒÉm"„ÄÅ‰øÑÊñá"–ª–µ—Ç"Á≠âÂêéÁºÄÔºåÁªü‰∏ÄÂä†Èü©Êñá"ÎÖÑ"
              if(baseField==='experience' && textValue){ 
                textValue = textValue.replace(/Âπ¥|nƒÉm|–ª–µ—Ç/g, '').trim() + 'ÎÖÑ'; 
              }
              // Â∑•ÁßçÔºöËΩ¨Êç¢‰∏∫ÂØπÂ∫îÁöÑÈü©ÊñáÂ∑•ÁßçÔºàÊîØÊåÅ‰∏≠Êñá„ÄÅË∂äÂçóÊñá„ÄÅ‰øÑÊñáÔºâ
              else if(baseField==='position' && textValue){ 
                textValue = convertPositionToKorean(textValue); 
              }
              // ÂßìÂêçÔºöÂ¶ÇÊûúÊòØ‰∏≠Êñá/Ë∂äÂçóÊñá/‰øÑÊñáÔºå‰øùÊåÅÂ∑≤ÁøªËØëÁöÑÈü©ÊñáÔºàÁî®Êà∑Â∫îËØ•Â∑≤ÁªèÁÇπÂáªÁøªËØëÊåâÈíÆÔºâ
              // ÂÖ∂‰ªñÂ≠óÊÆµ‰øùÊåÅÂéüÊ†∑ÔºàÂ¶ÇÊä§ÁÖßÂè∑„ÄÅÁîµËØùÂè∑„ÄÅÊó•ÊúüÁ≠â‰∏çÈúÄË¶ÅËΩ¨Êç¢Ôºâ
            }
            if(textValue){
              ctx.font = `${pos.fontSize || 44}px Arial`;
              ctx.fillStyle = pos.color || '#000';
              ctx.fillText(textValue, pos.x, pos.y);
            }
          });

          // Ë¥¥Á≠æÂêç - Êî∂ÈõÜÊâÄÊúâÁ≠æÂêç‰ΩçÁΩÆ
          const signaturePositions = [];
          Object.keys(positions).forEach(key=>{
            const pos = positions[key];
            if(!pos) return;
            const baseField = pos.baseField || key;
            if(baseField==='signature' && state.signature){
              signaturePositions.push({x: pos.x, y: pos.y, width: pos.width || 150, height: pos.height || 50});
            }
          });

          // Á≠âÂæÖÊâÄÊúâÁ≠æÂêçÂä†ËΩΩÂÆåÊàê
          if(signaturePositions.length > 0){
            Promise.all(signaturePositions.map(sigPos => {
              return new Promise((resolveSign) => {
                const sigImg = new Image();
                sigImg.onload = () => {
                  ctx.drawImage(sigImg, sigPos.x, sigPos.y, sigPos.width, sigPos.height);
                  resolveSign();
                };
                sigImg.onerror = () => resolveSign(); // Âç≥‰ΩøÂ§±Ë¥•‰πüÁªßÁª≠
                sigImg.src = state.signature;
              });
            })).then(() => {
              // ÊâÄÊúâÁ≠æÂêçÁªòÂà∂ÂÆåÊàêÂêéÂÜçÂØºÂá∫
              canvas.toBlob(blob=>{
                const userName = state.formData['name'] || 'Êú™ÂëΩÂêç';
                const docType = templateType==='contract'?'Í∑ºÎ°úÍ≥ÑÏïΩÏÑú':'ÏïàÏ†ÑÌòëÏïΩ';
                const filename = `${userName}_${docType}.png`;
                safeDownloadFromBlob(blob, filename);
                resolve();
              });
            });
          } else {
            // Ê≤°ÊúâÁ≠æÂêçÁõ¥Êé•ÂØºÂá∫
            canvas.toBlob(blob=>{
              const userName = state.formData['name'] || 'Êú™ÂëΩÂêç';
              const docType = templateType==='contract'?'Í∑ºÎ°úÍ≥ÑÏïΩÏÑú':'ÏïàÏ†ÑÌòëÏïΩ';
              const filename = `${userName}_${docType}.png`;
              safeDownloadFromBlob(blob, filename);
              resolve();
            });
          }
        };
        img.src = template;
      });
    }

    // ===================== ‰∏ä‰º†/ÂÆö‰Ωç =====================
    function handleTemplateUpload(e, templateType, langKey){
      const file = e.target.files[0];
      if(file){
        const reader = new FileReader();
        reader.onload = (ev)=>{
          state.templates[templateType][langKey] = ev.target.result;
          saveToLocalStorage(); render(); setTimeout(renderFieldMarkers, 100);
        };
        reader.readAsDataURL(file);
      }
    }

    function handleImageClick(e){
      const img = e.target;
      const rect = img.getBoundingClientRect();
      const scaleX = img.naturalWidth / rect.width;
      const scaleY = img.naturalHeight / rect.height;
      const x = (e.clientX - rect.left) * scaleX;
      const y = (e.clientY - rect.top) * scaleY;
      const positions = state.fieldPositions[state.currentTemplate][state.currentLang];
      let fieldKey;

      if(state.repositionTarget){ fieldKey = state.repositionTarget; state.repositionTarget=null; }
      else if(state.selectedField){
        fieldKey = state.selectedField;
        if(state.multiInstanceMode && positions[fieldKey]){
          let i=2; while(positions[`${state.selectedField}_${i}`]) i++;
          fieldKey = `${state.selectedField}_${i}`;
        }
      } else { return; }

      positions[fieldKey] = {
        x:Math.round(x), y:Math.round(y),
        fontSize: positions[fieldKey]?.fontSize || 44,
        color: positions[fieldKey]?.color || '#000000',
        baseField: positions[fieldKey]?.baseField || state.selectedField || fieldKey.replace(/_\\d+$/, ''),
        width: (positions[fieldKey]?.baseField==='signature' || state.selectedField==='signature') ? (positions[fieldKey]?.width || 150) : undefined,
        height:(positions[fieldKey]?.baseField==='signature' || state.selectedField==='signature') ? (positions[fieldKey]?.height|| 50) : undefined
      };
      saveToLocalStorage(); render(); setTimeout(renderFieldMarkers, 50);
    }

    function repositionField(key){ state.repositionTarget=key; state.selectedField=null; render(); }
    function editField(name){ state.editingField=name; render(); }
    function deleteField(name){
      if(confirm('Á°ÆÂÆöÂà†Èô§ËØ•Â≠óÊÆµÈÖçÁΩÆÂêó?')){
        delete state.fieldPositions[state.currentTemplate][state.currentLang][name];
        saveToLocalStorage(); render(); setTimeout(renderFieldMarkers, 50);
      }
    }
    function saveFieldParams(){
      const fz = document.getElementById('editFontSize').value;
      const color = document.getElementById('editColor').value;
      const w = document.getElementById('editWidth')?.value;
      const h = document.getElementById('editHeight')?.value;
      const pos = state.fieldPositions[state.currentTemplate][state.currentLang][state.editingField];
      pos.fontSize = parseInt(fz); pos.color = color;
      if(w) pos.width = parseInt(w); if(h) pos.height = parseInt(h);
      state.editingField=null; saveToLocalStorage(); render(); setTimeout(renderFieldMarkers, 50);
    }

    function downloadConfig(){
      const conf = { templates: state.templates, fieldPositions: state.fieldPositions };
      const blob = new Blob([JSON.stringify(conf,null,2)], {type:'application/json'});
      safeDownloadFromBlob(blob, 'form-config.json');
    }
    function loadConfig(e){
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (ev)=>{
        try{
          const conf = JSON.parse(ev.target.result);
          state.templates = conf.templates || { contract:{ zh:null, ko:null }, safety:{ zh:null, ko:null } };
          state.fieldPositions = conf.fieldPositions || { contract:{ zh:{}, ko:{} }, safety:{ zh:{}, ko:{} } };
          saveToLocalStorage(); render(); setTimeout(renderFieldMarkers, 100);
          alert('‚úÖ ÈÖçÁΩÆÂØºÂÖ•ÊàêÂäü!');
        }catch{ alert('‚ùå ÈÖçÁΩÆÊñá‰ª∂Ê†ºÂºèÈîôËØØ'); }
      };
      reader.readAsText(file);
    }
    function clearAllData(){
      if(confirm('‚ö†Ô∏è Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÈÖçÁΩÆÂêó?Ê≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç!')){
        localStorage.removeItem('formFillerConfig');
        state.templates = { contract:{ zh:null, ko:null }, safety:{ zh:null, ko:null } };
        state.fieldPositions = { contract:{ zh:{}, ko:{} }, safety:{ zh:{}, ko:{} } };
        render(); alert('‚úÖ ÊâÄÊúâÈÖçÁΩÆÂ∑≤Ê∏ÖÁ©∫');
      }
    }

    // ===================== Ê®°ÂºèÂàáÊç¢ & ÂØÜÁ†ÅÈ°µ =====================
    function toggleMode(){
      if(!state.isAdminMode){ state.showPasswordPage=true; render(); }
      else { state.isAdminMode=false; render(); }
    }
    function checkPassword(){
      const pwd = document.getElementById('passwordInput').value;
      const error = document.getElementById('errorMsg');
      if(pwd==='admin123'){ state.showPasswordPage=false; state.isAdminMode=true; render(); }
      else { error.classList.add('show'); setTimeout(()=>error.classList.remove('show'), 2000); }
    }
    function cancelPassword(){ state.showPasswordPage=false; render(); }
    function handlePasswordKeyPress(e){ if(e.key==='Enter') checkPassword(); }

    // ===================== Ê∏≤ÊüìËæÖÂä© =====================
    function getExampleText(fieldKey, lang){
      const base = fieldKey.replace(/_\\d+$/, '');
      const examples = {
        name:{ zh:'Âº†‰∏â', ko:'ÍπÄÏ≤†Ïàò', vi:'Nguy·ªÖn VƒÉn A', ru:'–ò–≤–∞–Ω–æ–≤' },
        birthday:{ zh:'1990-01-01', ko:'1990-01-01', vi:'1990-01-01', ru:'1990-01-01' },
        address:{ zh:'Âåó‰∫¨Â∏ÇÊúùÈò≥Âå∫', ko:'ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨', vi:'H√† N·ªôi', ru:'–ú–æ—Å–∫–≤–∞' },
        position:{ zh:'Êï¥ÁêÜ', ko:'Ï†ïÎ¶¨', vi:'Ï†ïÎ¶¨', ru:'Ï†ïÎ¶¨' },
        passport:{ zh:'E12345678', ko:'M12345678', vi:'B1234567', ru:'AB1234567' },
        phone:{ zh:'138-0013-8000', ko:'010-1234-5678', vi:'091-2345-678', ru:'+7 900 123-45-67' },
        residentNum:{ zh:'110101-1990011234', ko:'900101-1234567', vi:'001090-0001234', ru:'123456-7890123' },
        experience:{ zh:'3Âπ¥', ko:'3ÎÖÑ', vi:'3 nƒÉm', ru:'3 –ª–µ—Ç' },
        month:{ zh:getCurrentMonth(), ko:getCurrentMonth(), vi:getCurrentMonth(), ru:getCurrentMonth() },
        day:{ zh:getCurrentDay(), ko:getCurrentDay(), vi:getCurrentDay(), ru:getCurrentDay() },
        checkmark:{ zh:'‚úì', ko:'‚úì', vi:'‚úì', ru:'‚úì' },
        signature:{ zh:'Âº†‰∏â', ko:'ÍπÄÏ≤†Ïàò', vi:'Nguy·ªÖn VƒÉn A', ru:'–ò–≤–∞–Ω–æ–≤' }
      };
      const langKey = (lang==='ko'||lang==='vi'||lang==='ru')?lang:'zh';
      return examples[base]?.[langKey] || 'Á§∫‰æã';
    }

    function renderFieldMarkers(){
      const img = document.getElementById('templateImage');
      const container = document.getElementById('markersContainer');
      if(!img || !container) return;
      const positions = state.fieldPositions[state.currentTemplate][state.currentLang] || {};
      container.innerHTML='';

      const displayWidth = img.clientWidth, displayHeight = img.clientHeight;
      const naturalWidth = img.naturalWidth, naturalHeight = img.naturalHeight;
      const scaleX = displayWidth / naturalWidth, scaleY = displayHeight / naturalHeight;

      let idx=1;
      Object.keys(positions).forEach(key=>{
        const pos = positions[key]; if(!pos || pos.x==null || pos.y==null) return;
        const dx = pos.x * scaleX, dy = pos.y * scaleY;
        const baseField = pos.baseField || key;

        const marker = document.createElement('div'); marker.className='field-marker'; marker.textContent=idx;
        marker.style.left = dx+'px'; marker.style.top = dy+'px';
        const label = document.createElement('div'); label.className='field-label'; label.textContent=key; label.style.left=dx+'px'; label.style.top=dy+'px';
        container.appendChild(marker); container.appendChild(label);

        if(baseField!=='signature'){
          const previewText = document.createElement('div');
          previewText.className='field-preview-text';
          previewText.textContent = getExampleText(key, state.currentLang);
          previewText.style.left = dx+'px'; previewText.style.top = dy+'px';
          previewText.style.fontSize = ((pos.fontSize||44) * scaleX) + 'px';
          previewText.style.color = pos.color || '#000';
          previewText.style.fontFamily = 'Arial';
          container.appendChild(previewText);
        }else{
          const sigBox = document.createElement('div');
          sigBox.style.position='absolute'; sigBox.style.left=dx+'px'; sigBox.style.top=dy+'px';
          sigBox.style.width=((pos.width||150)*scaleX)+'px'; sigBox.style.height=((pos.height||50)*scaleY)+'px';
          sigBox.style.border='2px dashed rgba(74,144,164,.6)'; sigBox.style.backgroundColor='rgba(74,144,164,.1)'; sigBox.style.zIndex='8';
          container.appendChild(sigBox);
        }
        idx++;
      });
    }

    function getFieldDisplayName(key){
      const m = key.match(/^(.+)_([0-9]+)$/); if(m) return `${m[1]} (${m[2]})`; return key;
    }

    // ===================== UIÊ∏≤Êüì =====================
    function renderPasswordPage(){
      return `
        <div class="container password-container">
          <h2 class="password-title">ÁÆ°ÁêÜÂëòÈ™åËØÅ</h2>
          <p class="password-subtitle">ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂëòÂØÜÁ†Å‰ª•ÁªßÁª≠</p>
          <input type="password" id="passwordInput" class="password-input" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" onkeypress="handlePasswordKeyPress(event)" autofocus>
          <button onclick="checkPassword()" class="password-btn">Á°ÆËÆ§ÁôªÂΩï</button>
          <p id="errorMsg" class="password-error">‚ùå ÂØÜÁ†ÅÈîôËØØ,ËØ∑ÈáçËØï</p>
          <button onclick="cancelPassword()" class="clear-btn">ËøîÂõû</button>
        </div>
      `;
    }

    function renderAdminMode(){
      const t = translations[state.language];
      const positions = state.fieldPositions[state.currentTemplate][state.currentLang] || {};
      const fieldsList = getFieldsList(state.currentLang);
      return `
        <div class="container admin-container">
          <div class="admin-header">
            <h1 class="admin-title">ÁÆ°ÁêÜÂëòÈÖçÁΩÆÊ®°Âºè</h1>
            <button onclick="toggleMode()" class="toggle-btn">${t.userMode}</button>
          </div>

          <div class="admin-layout">
            <div class="left-panel">
              <h3 class="section-title">üìã Ê®°ÊùøÈÖçÁΩÆ</h3>
              <div class="template-tabs">
                <button onclick="state.currentTemplate='contract'; render(); setTimeout(renderFieldMarkers,100);" class="tab-btn ${state.currentTemplate==='contract'?'active':''}">Âä≥Âä®ÂêàÂêå</button>
                <button onclick="state.currentTemplate='safety'; render(); setTimeout(renderFieldMarkers,100);" class="tab-btn ${state.currentTemplate==='safety'?'active':''}">ÂÆâÂÖ®ÂçèËÆÆ</button>
              </div>
              <div class="language-tabs">
                <button onclick="state.currentLang='zh'; render(); setTimeout(renderFieldMarkers,100);" class="lang-btn ${state.currentLang==='zh'?'active':''}">‰∏≠Êñá/Ë∂äÂçóËØ≠/‰øÑËØ≠</button>
                <button onclick="state.currentLang='ko'; render(); setTimeout(renderFieldMarkers,100);" class="lang-btn ${state.currentLang==='ko'?'active':''}">ÌïúÍµ≠Ïñ¥</button>
              </div>

              <div class="upload-section">
                <label>üì§ ‰∏ä‰º† ${state.currentTemplate==='contract'?'Âä≥Âä®ÂêàÂêå':'ÂÆâÂÖ®ÂçèËÆÆ'} Ê®°Êùø (${state.currentLang==='zh'?'‰∏≠Êñá/Ë∂äÂçóËØ≠/‰øÑËØ≠':'ÌïúÍµ≠Ïñ¥'})</label>
                <input type="file" accept="image/*" onchange="handleTemplateUpload(event,'${state.currentTemplate}','${state.currentLang}')" style="margin-top:10px;">
              </div>

              <div class="form-group">
                <label>üéØ ÈÄâÊã©Â≠óÊÆµ (ÁÇπÂáªÂêéÂÜçÁÇπÂáªÂõæÁâáÂÆö‰Ωç)</label>
                <div class="field-buttons">
                  ${fieldsList.map(f=>`<button onclick="state.selectedField='${f}'; render();" class="field-btn ${state.selectedField===f?'active':''}">${f==='checkmark'?'‚úì':f}</button>`).join('')}
                </div>
                <div class="mode-switch">
                  <input type="checkbox" id="multiInstanceMode" ${state.multiInstanceMode?'checked':''} onchange="state.multiInstanceMode=this.checked; render();">
                  <label for="multiInstanceMode">üîÑ Â§öÂÆû‰æãÊ®°Âºè(Âêå‰∏ÄÂ≠óÊÆµÂàõÂª∫Â§ö‰∏™‰ΩçÁΩÆ)</label>
                </div>
                <p class="note">${state.multiInstanceMode?'‚úÖ Â§öÂÆû‰æãÊ®°Âºè: ÁÇπÂáªÂõæÁâá‰ºöÂàõÂª∫ name_2 / name_3...':'üîç ÊôÆÈÄöÊ®°Âºè: ÁÇπÂáªÂõæÁâáÊõ¥Êñ∞ÊâÄÈÄâÂ≠óÊÆµÂùêÊ†á'}</p>
                <p class="note" style="color:#4A90A4;">üí° Êúà‰ªΩ/Êó•Êúü/ÂØπÂè∑‰ºöËá™Âä®Â°´ÂÖÖÂΩìÂâçÂÄº</p>
              </div>

              ${state.templates[state.currentTemplate][state.currentLang] ? `
                <div class="preview-box">
                  <p style="margin-bottom:10px; font-weight:600; color:#2E4F7A;">
                    ${state.repositionTarget ? `üéØ ÁÇπÂáªÂõæÁâáÈáçÊñ∞ÂÆö‰Ωç: ${getFieldDisplayName(state.repositionTarget)}` : (state.selectedField ? `‚úÖ Â∑≤ÈÄâÊã©: ${state.selectedField}` : '‚ö†Ô∏è ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™Â≠óÊÆµ')}
                  </p>
                  <div class="image-wrapper">
                    <img id="templateImage" src="${state.templates[state.currentTemplate][state.currentLang]}" alt="template" onclick="handleImageClick(event)" onload="renderFieldMarkers()">
                    <div id="markersContainer"></div>
                  </div>
                </div>
              ` : '<p class="note" style="text-align:center; padding:40px;">ËØ∑ÂÖà‰∏ä‰º†Ê®°ÊùøÂõæÁâá</p>'}

              <div class="field-buttons" style="gap:15px; margin-top:10px;">
                <button onclick="downloadConfig()" class="action-btn" style="background:#4A90A4; color:#fff;">üì• ÂØºÂá∫ÈÖçÁΩÆ</button>
                <label class="action-btn" style="background:#3E5F8A; color:#fff;">üì§ ÂØºÂÖ•ÈÖçÁΩÆ
                  <input type="file" accept=".json" onchange="loadConfig(event)" style="display:none">
                </label>
                <button onclick="clearAllData()" class="action-btn" style="background:#C73E1D; color:#fff;">üóëÔ∏è Ê∏ÖÁ©∫ÈÖçÁΩÆ</button>
              </div>
              <p class="note">üíæ ÈÖçÁΩÆ‰ºöËá™Âä®‰øùÂ≠òÂà∞ÊµèËßàÂô®Êú¨Âú∞</p>
            </div>

            <div class="right-panel">
              <h3 class="section-title">‚öôÔ∏è Â∑≤ÈÖçÁΩÆÂ≠óÊÆµ</h3>
              ${Object.keys(positions).length===0 ? '<p class="note" style="text-align:center; padding:20px;">ÊöÇÊó†ÈÖçÁΩÆ</p>' :
                `<div class="field-list">
                  ${Object.keys(positions).map(k=>{
                    const pos = positions[k]; const base = pos.baseField || k;
                    return `
                      <div class="field-item">
                        <div class="field-item-header">
                          <span class="field-name">üìå ${getFieldDisplayName(k)}</span>
                          <div class="field-actions">
                            <button onclick="repositionField('${k}')" class="reposition-btn">ÈáçÊñ∞ÂÆö‰Ωç</button>
                            <button onclick="editField('${k}')" class="edit-btn">ÁºñËæë</button>
                            <button onclick="deleteField('${k}')" class="delete-btn">Âà†Èô§</button>
                          </div>
                        </div>
                        ${state.editingField===k ? `
                          <div class="param-editor">
                            <div class="param-row"><span class="param-label">Â≠ó‰ΩìÂ§ßÂ∞è:</span><input type="number" id="editFontSize" value="${pos.fontSize||44}" min="8" max="120"></div>
                            <div class="param-row"><span class="param-label">È¢úËâ≤:</span><input type="color" id="editColor" value="${pos.color||'#000000'}" style="height:40px;"></div>
                            ${base==='signature' ? `
                              <div class="param-row"><span class="param-label">ÂÆΩÂ∫¶:</span><input type="number" id="editWidth" value="${pos.width||150}" min="50" max="500"></div>
                              <div class="param-row"><span class="param-label">È´òÂ∫¶:</span><input type="number" id="editHeight" value="${pos.height||50}" min="20" max="200"></div>` : ''}
                            <button onclick="saveFieldParams()" class="save-param-btn">‚úÖ ‰øùÂ≠òÂèÇÊï∞</button>
                          </div>` :
                          `<div class="field-params" style="display:grid; grid-template-columns:1fr 1fr; gap:8px; font-size:12px; color:#5A7A8F;">
                            <div>X: ${pos.x}</div><div>Y: ${pos.y}</div>
                            <div>Â≠óÂè∑: ${pos.fontSize||44}px</div>
                            <div>È¢úËâ≤: <span style="display:inline-block; width:20px; height:20px; background:${pos.color||'#000'}; border:1px solid #ccc; vertical-align:middle;"></span></div>
                            ${pos.width?`<div>ÂÆΩ: ${pos.width}px</div>`:''}
                            ${pos.height?`<div>È´ò: ${pos.height}px</div>`:''}
                          </div>`}
                      </div>`;
                  }).join('')}
                </div>`}
            </div>
          </div>
        </div>
      `;
    }

    function renderUserMode(){
      const t = translations[state.language];
      
      // Â¶ÇÊûúÂú®‰∏ãËΩΩÈ°µÈù¢ÔºåÊòæÁ§∫‰∏ãËΩΩÁïåÈù¢
      if(state.showDownloadPage){
        const bothDownloaded = state.firstFormGenerated && state.secondFormGenerated;
        return `
          <div class="container">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
              <h1>${t.downloadTitle}</h1>
              <button onclick="state.showDownloadPage=false; render();" class="toggle-btn">${t.backToForm}</button>
            </div>

            <p class="note" style="background:#F0F8F9; border:2px solid #A8DADC; padding:15px; border-radius:8px; color:#2E4F7A; margin-bottom:25px; text-align:center; font-size:15px;">
              ${t.downloadHint}
            </p>

            <button 
              class="generate-btn" 
              onclick="generateFirstForm()" 
              style="margin-bottom:15px; ${state.firstFormGenerated ? 'background:#B8D4D6; opacity:0.7;' : ''}"
              ${state.firstFormGenerated ? 'disabled' : ''}>
              ${t.generateFirst} ${state.firstFormGenerated ? '‚úì' : ''}
            </button>

            <button 
              class="generate-btn" 
              onclick="generateSecondForm()" 
              style="margin-bottom:15px; ${state.secondFormGenerated ? 'background:#B8D4D6; opacity:0.7;' : ''}"
              ${state.secondFormGenerated ? 'disabled' : ''}>
              ${t.generateSecond} ${state.secondFormGenerated ? '‚úì' : ''}
            </button>

            <button 
              class="generate-btn" 
              onclick="${bothDownloaded ? 'openSmsApp()' : ''}" 
              style="background:${bothDownloaded ? 'linear-gradient(135deg,#4A90A4 0%, #3E5F8A 100%)' : '#D4E4E7'}; 
                     color:${bothDownloaded ? '#fff' : '#A0A0A0'}; 
                     cursor:${bothDownloaded ? 'pointer' : 'not-allowed'};
                     opacity:${bothDownloaded ? '1' : '0.6'};"
              ${bothDownloaded ? '' : 'disabled'}>
              ${t.sendToAdmin}
            </button>
          </div>
        `;
      }
      
      // Âê¶ÂàôÊòæÁ§∫Ë°®ÂçïÂ°´ÂÜôÁïåÈù¢
      const fields = getFieldsList(state.language).filter(f=>!['signature','month','day','checkmark'].includes(f));
      return `
        <div class="container">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h1>${t.title}</h1>
            <button onclick="toggleMode()" class="toggle-btn">${t.adminMode}</button>
          </div>

          <div class="form-group">
            <label>${t.selectLanguage}</label>
            <div class="language-buttons">
              ${[{code:'zh',label:'‰∏≠Êñá'},{code:'ko',label:'ÌïúÍµ≠Ïñ¥'},{code:'vi',label:'Ti·∫øng Vi·ªát'},{code:'ru',label:'–†—É—Å—Å–∫–∏–π'}].map(l=>`
                <button onclick=\"state.language='${l.code}'; keyboardVisible=false; render();\" class=\"lang-btn ${state.language===l.code?'active':''}\">${l.label}</button>`).join('')}
            </div>
          </div>

          ${fields.map(field=>{
            if(field==='position'){
              return `
                <div class="form-group">
                  <label>${t.position}</label>
                  <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <button onclick="state.positionMode='select'; render();" class="lang-btn ${state.positionMode==='select'?'active':''}" style="flex:1;">${t.positionSelect}</button>
                    <button onclick="state.positionMode='custom'; render();" class="lang-btn ${state.positionMode==='custom'?'active':''}" style="flex:1;">${t.positionCustom}</button>
                  </div>
                  ${state.positionMode==='custom'
                    ? `<input type="text" value="${state.formData[field]||''}" oninput="state.formData['${field}']=this.value">`
                    : `<select onchange="state.formData['${field}']=this.value"><option value="">-- ${t.positionSelect} --</option>${
                        positionOptions[state.language].map(opt=>`<option value=\"${opt}\" ${state.formData[field]===opt?'selected':''}>${opt}</option>`).join('')
                      }</select>`}
                </div>`;
            }else if(field==='phone'){
              return `
                <div class="form-group">
                  <label>${t.phone}</label>
                  <input type="text" value="${state.formData[field]||''}" oninput="
                    (function(v){ const n=v.replace(/\\D/g,''); let out=n.length<=3?n:n.length<=7? n.slice(0,3)+'-'+n.slice(3) : n.slice(0,3)+'-'+n.slice(3,7)+'-'+n.slice(7,11); state.formData['${field}']=out; })(this.value);
                    this.value = state.formData['${field}'];
                  ">
                </div>`;
            }else if(field==='residentNum'){
              return `
                <div class="form-group">
                  <label>${t.residentNum || 'Â±ÖÊ∞ë/Ë∫´‰ªΩËØÅÂè∑'}</label>
                  <input type="text" value="${state.formData[field]||''}" oninput="
                    (function(v){ const n=v.replace(/\\D/g,''); const out = n.length<=6 ? n : n.slice(0,6)+'-'+n.slice(6,13); state.formData['${field}']=out; })(this.value);
                    this.value = state.formData['${field}'];
                  ">
                </div>`;
            }else if(field==='experience'){
              return `
                <div class="form-group">
                  <label>${t.experience}</label>
                  <div style="position:relative;">
                    <input type="text" value="${state.formData[field]||''}" oninput="(function(v){ const n=v.replace(/\\D/g,''); state.formData['${field}']=n; })(this.value); this.value = state.formData['${field}'];" style="padding-right:50px;">
                    <span style="position:absolute; right:15px; top:50%; transform:translateY(-50%); color:#5A7A8F; font-size:14px; pointer-events:none;">${t.experienceYears}</span>
                  </div>
                </div>`;
            }else if(field==='name'){
              return `
                <div class="form-group">
                  <label>${t.name}</label>
                  ${state.language === 'ko' 
                    ? `<input type="text" value="${state.formData[field]||''}" oninput="state.formData['${field}']=this.value">`
                    : `<div style="display:flex; gap:10px; align-items:center;">
                        <input type="text" value="${state.formData[field]||''}" oninput="state.formData['${field}']=this.value" style="flex:1;">
                        <button type="button" onclick="toggleKeyboard()" class="keyboard-toggle-btn">‚å®Ô∏è</button>
                        <button type="button" onclick="translateName()" class="lang-btn" style="background:#4A90A4; color:#fff;">üîÑ ${t.translateName}</button>
                      </div>
                      ${keyboardVisible ? `
                        <div class="virtual-keyboard">
                          <div class="keyboard-title">üí° ÁÇπÂáªÂ≠óÁ¨¶ËæìÂÖ•ÂêçÂ≠ó</div>
                          <div class="keyboard-grid">
                            ${getKeyboardChars().map(char => `
                              <button class="char-btn" onclick="insertChar('${char}')">${char}</button>
                            `).join('')}
                          </div>
                          <div class="keyboard-controls">
                            <button class="keyboard-control-btn" onclick="deleteLastChar()">‚å´ Âà†Èô§</button>
                            <button class="keyboard-control-btn" onclick="clearName()">‚úï Ê∏ÖÁ©∫</button>
                          </div>
                        </div>
                      ` : ''}`
                  }
                </div>`;
            }else if(field==='address'){
              return `
                <div class="form-group">
                  <label>${t.address}</label>
                  <div style="display:flex; gap:10px;">
                    <input type="text" value="${state.formData[field]||''}" oninput="state.formData['${field}']=this.value" style="flex:1;">
                    <button type="button" onclick="openAddressSearch()" class="lang-btn" style="background:#3E5F8A; color:#fff;">üó∫Ô∏è ${t.addressSearch}</button>
                  </div>
                  <p class="note">${t.addressHint}</p>
                </div>`;
            }else{
              return `
                <div class="form-group">
                  <label>${t[field] || field}</label>
                  <input type="${field==='birthday' ? 'date' : 'text'}" value="${state.formData[field]||''}" oninput="state.formData['${field}']=this.value">
                </div>`;
            }
          }).join('')}

          <div class="form-group">
            <label>${t.signature}</label>
            <div class="signature-container">
              <canvas id="signatureCanvas" width="600" height="180"></canvas>
            </div>
            <button onclick="clearSignature(); render();" class="clear-btn">${t.clearSignature}</button>
          </div>

          <button class="generate-btn" onclick="completeFillForm()">
            ${t.complete}
          </button>
        </div>
      `;
    }

    function openAddressSearch(){
      // Â§öËØ≠Ë®ÄÊñáÊú¨ÂÆö‰πâ
      const texts = {
        zh: {
          mobilePrompt: 'Âç≥Â∞ÜÊâìÂºÄ Naver Âú∞Âõæ\n\nËØ∑Âú®Âú∞Âõæ‰∏≠ÊêúÁ¥¢ÊÇ®ÁöÑÂú∞ÂùÄÔºåÁÑ∂ÂêéÂ§çÂà∂Á≤òË¥¥ÂõûÊù•',
          title: 'Naver Âú∞ÂõæÂú∞ÂùÄÊêúÁ¥¢',
          instruction: 'ÁÇπÂáª‰∏ãÊñπÊåâÈíÆÂú®Êñ∞Ê†áÁ≠æÈ°µ‰∏≠ÊâìÂºÄ Naver Âú∞Âõæ<br>ÊêúÁ¥¢Âú∞ÂùÄÂêéÔºåÂ§çÂà∂ÂÆåÊï¥Âú∞ÂùÄ<br>ÁÑ∂ÂêéËøîÂõûÊ≠§È°µÈù¢Á≤òË¥¥',
          openButton: 'üåê ÊâìÂºÄ Naver Âú∞Âõæ',
          cancelButton: 'ÂèñÊ∂à'
        },
        ko: {
          mobilePrompt: 'Naver ÏßÄÎèÑÎ•º ÏóΩÎãàÎã§\n\nÏßÄÎèÑÏóêÏÑú Ï£ºÏÜåÎ•º Í≤ÄÏÉâÌïú ÌõÑ Î≥µÏÇ¨ÌïòÏó¨ Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî',
          title: 'Naver ÏßÄÎèÑ Ï£ºÏÜå Í≤ÄÏÉâ',
          instruction: 'ÏïÑÎûò Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÏÉà ÌÉ≠ÏóêÏÑú Naver ÏßÄÎèÑ Ïó¥Í∏∞<br>Ï£ºÏÜåÎ•º Í≤ÄÏÉâÌïú ÌõÑ Ï†ÑÏ≤¥ Ï£ºÏÜåÎ•º Î≥µÏÇ¨<br>Í∑∏Îü∞ Îã§Ïùå Ïù¥ ÌéòÏù¥ÏßÄÎ°ú ÎèåÏïÑÏôÄ Î∂ôÏó¨ÎÑ£Í∏∞',
          openButton: 'üåê Naver ÏßÄÎèÑ Ïó¥Í∏∞',
          cancelButton: 'Ï∑®ÏÜå'
        },
        vi: {
          mobilePrompt: 'M·ªü b·∫£n ƒë·ªì Naver\n\nT√¨m ki·∫øm ƒë·ªãa ch·ªâ tr√™n b·∫£n ƒë·ªì, sau ƒë√≥ sao ch√©p v√† d√°n l·∫°i',
          title: 'T√¨m ki·∫øm ƒë·ªãa ch·ªâ Naver Map',
          instruction: 'Nh·∫•p v√†o n√∫t b√™n d∆∞·ªõi ƒë·ªÉ m·ªü Naver Map trong tab m·ªõi<br>Sau khi t√¨m ki·∫øm, sao ch√©p ƒë·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß<br>Sau ƒë√≥ quay l·∫°i trang n√†y v√† d√°n',
          openButton: 'üåê M·ªü b·∫£n ƒë·ªì Naver',
          cancelButton: 'H·ªßy'
        },
        ru: {
          mobilePrompt: '–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–∞ Naver\n\n–ù–∞–π–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ, –∑–∞—Ç–µ–º —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ',
          title: '–ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞ –Ω–∞ –∫–∞—Ä—Ç–µ Naver',
          instruction: '–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É Naver –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ<br>–ü–æ—Å–ª–µ –ø–æ–∏—Å–∫–∞ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å<br>–ó–∞—Ç–µ–º –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –≤—Å—Ç–∞–≤—å—Ç–µ',
          openButton: 'üåê –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É Naver',
          cancelButton: '–û—Ç–º–µ–Ω–∞'
        }
      };
      
      const currentText = texts[state.language] || texts.zh;
      
      // Ê£ÄÊµãÊòØÂê¶‰∏∫ÁßªÂä®ËÆæÂ§á
      const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      
      if(isMobile){
        // ÁßªÂä®Á´ØÔºöÁõ¥Êé•ÊâìÂºÄNaverÂú∞ÂõæÂ∫îÁî®ÊàñÁΩëÈ°µ
        if(confirm(currentText.mobilePrompt)){
          // Â∞ùËØïÊâìÂºÄNaverÂú∞ÂõæÂ∫îÁî®ÔºåÂ¶ÇÊûúÂ§±Ë¥•ÂàôÊâìÂºÄÁΩëÈ°µÁâà
          window.open('nmap://search?query=', '_blank') || window.open('https://map.naver.com/', '_blank');
        }
      } else {
        // Ê°åÈù¢Á´ØÔºöÊòæÁ§∫ÂºπÁ™ówithËØ¥ÊòéÂíåÊåâÈíÆ
        const overlay = document.createElement('div');
        overlay.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,.85); z-index:999999; display:flex; align-items:center; justify-content:center; padding:20px;';

        const content = document.createElement('div');
        content.style.cssText = 'background:#fff; border-radius:12px; width:95%; max-width:500px; padding:30px; display:flex; flex-direction:column; gap:20px;';
        content.innerHTML = `
          <div style="text-align:center;">
            <div style="font-size:48px; margin-bottom:15px;">üó∫Ô∏è</div>
            <h2 style="color:#2E4F7A; margin-bottom:10px;">${currentText.title}</h2>
            <p style="color:#5A7A8F; line-height:1.6;">
              ${currentText.instruction}
            </p>
          </div>
          
          <button onclick="window.open('https://map.naver.com/', '_blank')" 
                  style="padding:15px; background:linear-gradient(135deg,#3E5F8A 0%, #2E4F7A 100%); color:#fff; border:none; border-radius:8px; font-size:16px; font-weight:600; cursor:pointer;">
            ${currentText.openButton}
          </button>
          
          <button onclick="document.getElementById('mapModal').remove(); document.body.style.overflow='';" 
                  style="padding:12px; background:#E8F0F2; color:#2C3E50; border:none; border-radius:8px; font-size:14px; cursor:pointer;">
            ${currentText.cancelButton}
          </button>
        `;

        const wrapper = document.createElement('div');
        wrapper.id = 'mapModal';
        wrapper.appendChild(overlay);
        overlay.appendChild(content);
        document.body.appendChild(wrapper);
        document.body.style.overflow = 'hidden';
        
        overlay.addEventListener('click', (e)=>{ 
          if(e.target===overlay){ 
            wrapper.remove(); 
            document.body.style.overflow=''; 
          } 
        });
      }
    }

    function openSmsApp(){
      const phone = state.formData.receiverPhone;
      if(!phone){
        const messages = { 
          zh:'ËØ∑ÂÖàËæìÂÖ•Êé•Êî∂ËÄÖÊâãÊú∫Âè∑', 
          ko:'ÏàòÏã† Ï†ÑÌôîÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 
          vi:'Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i nh·∫≠n', 
          ru:'–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è' 
        };
        alert(messages[state.language] || 'ËØ∑ÂÖàËæìÂÖ•Êé•Êî∂ËÄÖÊâãÊú∫Âè∑');
        return;
      }
      
      // ÁßªÈô§ÊâãÊú∫Âè∑‰∏≠ÁöÑÊâÄÊúâÈùûÊï∞Â≠óÂ≠óÁ¨¶
      const cleanPhone = phone.replace(/\D/g, '');
      
      // ‰ΩøÁî® sms: URL scheme ÊâìÂºÄÁü≠‰ø°Â∫îÁî®
      const smsUrl = `sms:${cleanPhone}`;
      
      try {
        window.location.href = smsUrl;
      } catch(e) {
        // Â¶ÇÊûúÂ§±Ë¥•ÔºåÂ∞ùËØïÁî® window.open
        window.open(smsUrl, '_self');
      }
    }

    // ===================== ÊâìÂºÄÁü≠‰ø°Â∫îÁî® =====================
    function openSmsApp(){
      // Âõ∫ÂÆöÁöÑÁÆ°ÁêÜÂëòÊâãÊú∫Âè∑
      const phone = '010-3742-0131';
      
      // ÁßªÈô§ÊâÄÊúâÈùûÊï∞Â≠óÂ≠óÁ¨¶
      const cleanPhone = phone.replace(/\D/g, '');
      
      // ÊûÑÂª∫SMS URLÔºà‰∏çÂ∏¶È¢ÑËÆæÊ∂àÊÅØÔºâ
      const smsUrl = `sms:${cleanPhone}`;
      
      // ÊâìÂºÄÁü≠‰ø°Â∫îÁî®
      try {
        window.location.href = smsUrl;
      } catch(e) {
        window.open(smsUrl, '_self');
      }
    }

    // ===================== ‰∏ªÊ∏≤ÊüìÂÖ•Âè£ =====================
    function render(){
      const app = document.getElementById('app');
      if(state.showPasswordPage){ app.innerHTML = renderPasswordPage(); return; }
      app.innerHTML = state.isAdminMode ? renderAdminMode() : renderUserMode();

      // ÁªëÂÆöÁ≠æÂêçÊùø
      const canvas = document.getElementById('signatureCanvas');
      if(canvas){
        signatureCanvas = canvas; sigCtx = canvas.getContext('2d'); sigCtx.lineWidth = 2; sigCtx.lineCap='round';
        canvas.addEventListener('mousedown', startDrawing); canvas.addEventListener('mousemove', draw); window.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('touchstart', startDrawing, {passive:true}); canvas.addEventListener('touchmove', draw, {passive:false}); window.addEventListener('touchend', stopDrawing);
      }
    }

    // ÂàùÂßãÂåñ
    initConfig();
  </script>

<script>
/* Âä†ËΩΩÂ§ñÈÉ®Â≠óÂÖ∏Êñá‰ª∂Ôºöchinese_char_map.json, vietnamese_char_map.json, russian_char_map.json
   Â∞ÜÂÆÉ‰ª¨ÂêàÂπ∂Âà∞ÂÜÖÂ≠ò‰∏≠ÁöÑÊò†Â∞ÑË°®‰∏≠„ÄÇ‰øùÁïôÁé∞ÊúâÁöÑÊò†Â∞Ñ‰Ωú‰∏∫ÂõûÈÄÄÊñπÊ°à„ÄÇ
*/
(function(){
  // Âä†ËΩΩ‰∏≠ÊñáÂ≠óÂÖ∏
  fetch('chinese_char_map.json')
    .then(r=>{ if(!r.ok) throw new Error('no chinese dict'); return r.json(); })
    .then(data=>{
      // ÂêàÂπ∂‰∏≠ÊñáÂßìÊ∞èÊò†Â∞Ñ
      if(data.chineseSurnameMap){
        Object.assign(window.chineseToKorean, data.chineseSurnameMap);
        console.log('‚úÖ Chinese surname map loaded:', Object.keys(data.chineseSurnameMap).length, 'entries');
      }
      // ÂêàÂπ∂‰∏≠ÊñáÂ≠óÁ¨¶Êò†Â∞Ñ
      if(data.chineseCharMap){
        Object.assign(window.chineseToKorean, data.chineseCharMap);
        console.log('‚úÖ Chinese character map loaded:', Object.keys(data.chineseCharMap).length, 'entries');
      }
      console.log('‚úÖ chinese_char_map.json loaded successfully.');
    })
    .catch(err=>{
      console.log('‚ùå chinese_char_map.json not found or failed to load:', err.message);
    });

  // Âä†ËΩΩË∂äÂçóÊñáÂ≠óÂÖ∏  
  fetch('vietnamese_char_map.json')
    .then(r=>{ if(!r.ok) throw new Error('no vietnamese dict'); return r.json(); })
    .then(data=>{
      // Áõ¥Êé•ÂêàÂπ∂Ë∂äÂçóÊñáÊò†Â∞ÑÔºàÂÆÉÊòØ‰∏Ä‰∏™ÁÆÄÂçïÁöÑÈîÆÂÄºÂØπÂØπË±°Ôºâ
      Object.assign(window.vietnameseToKorean, data);
      console.log('‚úÖ Vietnamese character map loaded:', Object.keys(data).length, 'entries');
      console.log('‚úÖ vietnamese_char_map.json loaded successfully.');
    })
    .catch(err=>{
      console.log('‚ùå vietnamese_char_map.json not found or failed to load:', err.message);
    });
  
  // Âä†ËΩΩ‰øÑÊñáÂ≠óÂÖ∏
  fetch('russian_char_map.json')
    .then(r=>{ if(!r.ok) throw new Error('no russian dict'); return r.json(); })
    .then(data=>{
      // ÂêàÂπ∂‰øÑÊñáÂÆåÊï¥ÂêçÂ≠óÊò†Â∞Ñ
      if(data.units){
        window.russianUnits = data.units;
        console.log('‚úÖ Russian name units loaded:', Object.keys(data.units).length, 'entries');
      }
      // Âä†ËΩΩÂêéÁºÄËßÑÂàô
      if(data.suffix){
        window.russianSuffix = data.suffix;
        console.log('‚úÖ Russian suffix rules loaded:', Object.keys(data.suffix).length, 'rules');
      }
      // Âä†ËΩΩÈõÜÁæ§ËßÑÂàô
      if(data.cluster && Array.isArray(data.cluster)){
        window.russianCluster = data.cluster;
        console.log('‚úÖ Russian cluster rules loaded:', data.cluster.length, 'rules');
      }
      console.log('‚úÖ russian_char_map.json loaded successfully.');
    })
    .catch(err=>{
      console.log('‚ùå russian_char_map.json not found or failed to load:', err.message);
    });
})();
</script>
</body>

</html>
